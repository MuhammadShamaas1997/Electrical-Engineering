<!DOCTYPE html>
<!-- saved from url=(0062)https://meep.readthedocs.io/en/latest/Python_Tutorials/Basics/ -->
<html class=" js flexbox flexboxlegacy canvas canvastext webgl no-touch geolocation postmessage websqldatabase indexeddb hashchange history draganddrop websockets rgba hsla multiplebgs backgroundsize borderimage borderradius boxshadow textshadow opacity cssanimations csscolumns cssgradients cssreflections csstransforms csstransforms3d csstransitions fontface generatedcontent video audio localstorage sessionstorage webworkers applicationcache svg inlinesvg smil svgclippaths" lang="en" style=""><script async="" src="./Tutorial_Basics - MEEP Documentation_files/analytics.js.download"></script><script type="text/javascript" charset="utf-8" id="zm-extension" src="chrome-extension://fdcgdnkidjaadafnichfpabhfomcebme/scripts/webrtc-patch.js" async=""></script><!--<![endif]--><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <meta name="author" content="MEEP Developers">
  <link rel="shortcut icon" href="https://meep.readthedocs.io/en/latest/img/favicon.ico">
  <title>Tutorial/Basics - MEEP Documentation</title>
  <link href="./Tutorial_Basics - MEEP Documentation_files/css" rel="stylesheet" type="text/css">

  <link rel="stylesheet" href="./Tutorial_Basics - MEEP Documentation_files/theme.css" type="text/css">
  <link rel="stylesheet" href="./Tutorial_Basics - MEEP Documentation_files/theme_extra.css" type="text/css">
  <link rel="stylesheet" href="./Tutorial_Basics - MEEP Documentation_files/highlight.css">
  <link href="./Tutorial_Basics - MEEP Documentation_files/badge_only.css" rel="stylesheet">
  <link href="./Tutorial_Basics - MEEP Documentation_files/readthedocs-doc-embed.css" rel="stylesheet">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Tutorial/Basics";
    var mkdocs_page_input_path = "Python_Tutorials/Basics.md";
    var mkdocs_page_url = "/Python_Tutorials/Basics/";
  </script>
  
  <script src="./Tutorial_Basics - MEEP Documentation_files/jquery-2.1.1.min.js.download"></script>
  <script src="./Tutorial_Basics - MEEP Documentation_files/modernizr-2.8.3.min.js.download"></script>
  <script type="text/javascript" src="./Tutorial_Basics - MEEP Documentation_files/highlight.pack.js.download"></script> 
  
<style type="text/css">.MathJax_Hover_Frame {border-radius: .25em; -webkit-border-radius: .25em; -moz-border-radius: .25em; -khtml-border-radius: .25em; box-shadow: 0px 0px 15px #83A; -webkit-box-shadow: 0px 0px 15px #83A; -moz-box-shadow: 0px 0px 15px #83A; -khtml-box-shadow: 0px 0px 15px #83A; border: 1px solid #A6D ! important; display: inline-block; position: absolute}
.MathJax_Menu_Button .MathJax_Hover_Arrow {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 4px; -webkit-border-radius: 4px; -moz-border-radius: 4px; -khtml-border-radius: 4px; font-family: 'Courier New',Courier; font-size: 9px; color: #F0F0F0}
.MathJax_Menu_Button .MathJax_Hover_Arrow span {display: block; background-color: #AAA; border: 1px solid; border-radius: 3px; line-height: 0; padding: 4px}
.MathJax_Hover_Arrow:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_Hover_Arrow:hover span {background-color: #CCC!important}
</style><style type="text/css">#MathJax_About {position: fixed; left: 50%; width: auto; text-align: center; border: 3px outset; padding: 1em 2em; background-color: #DDDDDD; color: black; cursor: default; font-family: message-box; font-size: 120%; font-style: normal; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; border-radius: 15px; -webkit-border-radius: 15px; -moz-border-radius: 15px; -khtml-border-radius: 15px; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_About.MathJax_MousePost {outline: none}
.MathJax_Menu {position: absolute; background-color: white; color: black; width: auto; padding: 2px; border: 1px solid #CCCCCC; margin: 0; cursor: default; font: menu; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; z-index: 201; box-shadow: 0px 10px 20px #808080; -webkit-box-shadow: 0px 10px 20px #808080; -moz-box-shadow: 0px 10px 20px #808080; -khtml-box-shadow: 0px 10px 20px #808080; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
.MathJax_MenuItem {padding: 2px 2em; background: transparent}
.MathJax_MenuArrow {position: absolute; right: .5em; padding-top: .25em; color: #666666; font-size: .75em}
.MathJax_MenuActive .MathJax_MenuArrow {color: white}
.MathJax_MenuArrow.RTL {left: .5em; right: auto}
.MathJax_MenuCheck {position: absolute; left: .7em}
.MathJax_MenuCheck.RTL {right: .7em; left: auto}
.MathJax_MenuRadioCheck {position: absolute; left: 1em}
.MathJax_MenuRadioCheck.RTL {right: 1em; left: auto}
.MathJax_MenuLabel {padding: 2px 2em 4px 1.33em; font-style: italic}
.MathJax_MenuRule {border-top: 1px solid #CCCCCC; margin: 4px 1px 0px}
.MathJax_MenuDisabled {color: GrayText}
.MathJax_MenuActive {background-color: Highlight; color: HighlightText}
.MathJax_MenuDisabled:focus, .MathJax_MenuLabel:focus {background-color: #E8E8E8}
.MathJax_ContextMenu:focus {outline: none}
.MathJax_ContextMenu .MathJax_MenuItem:focus {outline: none}
#MathJax_AboutClose {top: .2em; right: .2em}
.MathJax_Menu .MathJax_MenuClose {top: -10px; left: -10px}
.MathJax_MenuClose {position: absolute; cursor: pointer; display: inline-block; border: 2px solid #AAA; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; font-family: 'Courier New',Courier; font-size: 24px; color: #F0F0F0}
.MathJax_MenuClose span {display: block; background-color: #AAA; border: 1.5px solid; border-radius: 18px; -webkit-border-radius: 18px; -moz-border-radius: 18px; -khtml-border-radius: 18px; line-height: 0; padding: 8px 0 6px}
.MathJax_MenuClose:hover {color: white!important; border: 2px solid #CCC!important}
.MathJax_MenuClose:hover span {background-color: #CCC!important}
.MathJax_MenuClose:hover:focus {outline: none}
</style><style type="text/css">.MathJax_Preview .MJXf-math {color: inherit!important}
</style><style type="text/css">.MJX_Assistive_MathML {position: absolute!important; top: 0; left: 0; clip: rect(1px, 1px, 1px, 1px); padding: 1px 0 0 0!important; border: 0!important; height: 1px!important; width: 1px!important; overflow: hidden!important; display: block!important; -webkit-touch-callout: none; -webkit-user-select: none; -khtml-user-select: none; -moz-user-select: none; -ms-user-select: none; user-select: none}
.MJX_Assistive_MathML.MJX_Assistive_MathML_Block {width: 100%!important}
</style><style type="text/css">#MathJax_Zoom {position: absolute; background-color: #F0F0F0; overflow: auto; display: block; z-index: 301; padding: .5em; border: 1px solid black; margin: 0; font-weight: normal; font-style: normal; text-align: left; text-indent: 0; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; -webkit-box-sizing: content-box; -moz-box-sizing: content-box; box-sizing: content-box; box-shadow: 5px 5px 15px #AAAAAA; -webkit-box-shadow: 5px 5px 15px #AAAAAA; -moz-box-shadow: 5px 5px 15px #AAAAAA; -khtml-box-shadow: 5px 5px 15px #AAAAAA; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true')}
#MathJax_ZoomOverlay {position: absolute; left: 0; top: 0; z-index: 300; display: inline-block; width: 100%; height: 100%; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
#MathJax_ZoomFrame {position: relative; display: inline-block; height: 0; width: 0}
#MathJax_ZoomEventTrap {position: absolute; left: 0; top: 0; z-index: 302; display: inline-block; border: 0; padding: 0; margin: 0; background-color: white; opacity: 0; filter: alpha(opacity=0)}
</style><style type="text/css">.MathJax_Preview {color: #888}
#MathJax_Message {position: fixed; left: 1em; bottom: 1.5em; background-color: #E6E6E6; border: 1px solid #959595; margin: 0px; padding: 2px 8px; z-index: 102; color: black; font-size: 80%; width: auto; white-space: nowrap}
#MathJax_MSIE_Frame {position: absolute; top: 0; left: 0; width: 0px; z-index: 101; border: 0px; margin: 0px; padding: 0px}
.MathJax_Error {color: #CC0000; font-style: italic}
</style><style type="text/css">.MJXp-script {font-size: .8em}
.MJXp-right {-webkit-transform-origin: right; -moz-transform-origin: right; -ms-transform-origin: right; -o-transform-origin: right; transform-origin: right}
.MJXp-bold {font-weight: bold}
.MJXp-italic {font-style: italic}
.MJXp-scr {font-family: MathJax_Script,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-frak {font-family: MathJax_Fraktur,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-sf {font-family: MathJax_SansSerif,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-cal {font-family: MathJax_Caligraphic,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-mono {font-family: MathJax_Typewriter,'Times New Roman',Times,STIXGeneral,serif}
.MJXp-largeop {font-size: 150%}
.MJXp-largeop.MJXp-int {vertical-align: -.2em}
.MJXp-math {display: inline-block; line-height: 1.2; text-indent: 0; font-family: 'Times New Roman',Times,STIXGeneral,serif; white-space: nowrap; border-collapse: collapse}
.MJXp-display {display: block; text-align: center; margin: 1em 0}
.MJXp-math span {display: inline-block}
.MJXp-box {display: block!important; text-align: center}
.MJXp-box:after {content: " "}
.MJXp-rule {display: block!important; margin-top: .1em}
.MJXp-char {display: block!important}
.MJXp-mo {margin: 0 .15em}
.MJXp-mfrac {margin: 0 .125em; vertical-align: .25em}
.MJXp-denom {display: inline-table!important; width: 100%}
.MJXp-denom > * {display: table-row!important}
.MJXp-surd {vertical-align: top}
.MJXp-surd > * {display: block!important}
.MJXp-script-box > *  {display: table!important; height: 50%}
.MJXp-script-box > * > * {display: table-cell!important; vertical-align: top}
.MJXp-script-box > *:last-child > * {vertical-align: bottom}
.MJXp-script-box > * > * > * {display: block!important}
.MJXp-mphantom {visibility: hidden}
.MJXp-munderover {display: inline-table!important}
.MJXp-over {display: inline-block!important; text-align: center}
.MJXp-over > * {display: block!important}
.MJXp-munderover > * {display: table-row!important}
.MJXp-mtable {vertical-align: .25em; margin: 0 .125em}
.MJXp-mtable > * {display: inline-table!important; vertical-align: middle}
.MJXp-mtr {display: table-row!important}
.MJXp-mtd {display: table-cell!important; text-align: center; padding: .5em 0 0 .5em}
.MJXp-mtr > .MJXp-mtd:first-child {padding-left: 0}
.MJXp-mtr:first-child > .MJXp-mtd {padding-top: 0}
.MJXp-mlabeledtr {display: table-row!important}
.MJXp-mlabeledtr > .MJXp-mtd:first-child {padding-left: 0}
.MJXp-mlabeledtr:first-child > .MJXp-mtd {padding-top: 0}
.MJXp-merror {background-color: #FFFF88; color: #CC0000; border: 1px solid #CC0000; padding: 1px 3px; font-style: normal; font-size: 90%}
.MJXp-scale0 {-webkit-transform: scaleX(.0); -moz-transform: scaleX(.0); -ms-transform: scaleX(.0); -o-transform: scaleX(.0); transform: scaleX(.0)}
.MJXp-scale1 {-webkit-transform: scaleX(.1); -moz-transform: scaleX(.1); -ms-transform: scaleX(.1); -o-transform: scaleX(.1); transform: scaleX(.1)}
.MJXp-scale2 {-webkit-transform: scaleX(.2); -moz-transform: scaleX(.2); -ms-transform: scaleX(.2); -o-transform: scaleX(.2); transform: scaleX(.2)}
.MJXp-scale3 {-webkit-transform: scaleX(.3); -moz-transform: scaleX(.3); -ms-transform: scaleX(.3); -o-transform: scaleX(.3); transform: scaleX(.3)}
.MJXp-scale4 {-webkit-transform: scaleX(.4); -moz-transform: scaleX(.4); -ms-transform: scaleX(.4); -o-transform: scaleX(.4); transform: scaleX(.4)}
.MJXp-scale5 {-webkit-transform: scaleX(.5); -moz-transform: scaleX(.5); -ms-transform: scaleX(.5); -o-transform: scaleX(.5); transform: scaleX(.5)}
.MJXp-scale6 {-webkit-transform: scaleX(.6); -moz-transform: scaleX(.6); -ms-transform: scaleX(.6); -o-transform: scaleX(.6); transform: scaleX(.6)}
.MJXp-scale7 {-webkit-transform: scaleX(.7); -moz-transform: scaleX(.7); -ms-transform: scaleX(.7); -o-transform: scaleX(.7); transform: scaleX(.7)}
.MJXp-scale8 {-webkit-transform: scaleX(.8); -moz-transform: scaleX(.8); -ms-transform: scaleX(.8); -o-transform: scaleX(.8); transform: scaleX(.8)}
.MJXp-scale9 {-webkit-transform: scaleX(.9); -moz-transform: scaleX(.9); -ms-transform: scaleX(.9); -o-transform: scaleX(.9); transform: scaleX(.9)}
.MathJax_PHTML .noError {vertical-align: ; font-size: 90%; text-align: left; color: black; padding: 1px 3px; border: 1px solid}
</style><script src="./Tutorial_Basics - MEEP Documentation_files/219a518e556d3408a6.js.download" type="text/javascript"></script><script type="text/javascript" src="./Tutorial_Basics - MEEP Documentation_files/bc.js.download"></script><script src="./Tutorial_Basics - MEEP Documentation_files/l.js.download" type="text/javascript"></script><script src="./Tutorial_Basics - MEEP Documentation_files/l.js(1).download" type="text/javascript"></script><img style="width:0;height:0;display:none;visibility:hidden;" src="./Tutorial_Basics - MEEP Documentation_files/saved_resource(1)"><style type="text/css">.MathJax_Display {text-align: center; margin: 1em 0em; position: relative; display: block!important; text-indent: 0; max-width: none; max-height: none; min-width: 0; min-height: 0; width: 100%}
.MathJax .merror {background-color: #FFFF88; color: #CC0000; border: 1px solid #CC0000; padding: 1px 3px; font-style: normal; font-size: 90%}
.MathJax .MJX-monospace {font-family: monospace}
.MathJax .MJX-sans-serif {font-family: sans-serif}
#MathJax_Tooltip {background-color: InfoBackground; color: InfoText; border: 1px solid black; box-shadow: 2px 2px 5px #AAAAAA; -webkit-box-shadow: 2px 2px 5px #AAAAAA; -moz-box-shadow: 2px 2px 5px #AAAAAA; -khtml-box-shadow: 2px 2px 5px #AAAAAA; filter: progid:DXImageTransform.Microsoft.dropshadow(OffX=2, OffY=2, Color='gray', Positive='true'); padding: 3px 4px; z-index: 401; position: absolute; left: 0; top: 0; width: auto; height: auto; display: none}
.MathJax {display: inline; font-style: normal; font-weight: normal; line-height: normal; font-size: 100%; font-size-adjust: none; text-indent: 0; text-align: left; text-transform: none; letter-spacing: normal; word-spacing: normal; word-wrap: normal; white-space: nowrap; float: none; direction: ltr; max-width: none; max-height: none; min-width: 0; min-height: 0; border: 0; padding: 0; margin: 0}
.MathJax:focus, body :focus .MathJax {display: inline-table}
.MathJax.MathJax_FullWidth {text-align: center; display: table-cell!important; width: 10000em!important}
.MathJax img, .MathJax nobr, .MathJax a {border: 0; padding: 0; margin: 0; max-width: none; max-height: none; min-width: 0; min-height: 0; vertical-align: 0; line-height: normal; text-decoration: none}
img.MathJax_strut {border: 0!important; padding: 0!important; margin: 0!important; vertical-align: 0!important}
.MathJax span {display: inline; position: static; border: 0; padding: 0; margin: 0; vertical-align: 0; line-height: normal; text-decoration: none}
.MathJax nobr {white-space: nowrap!important}
.MathJax img {display: inline!important; float: none!important}
.MathJax * {transition: none; -webkit-transition: none; -moz-transition: none; -ms-transition: none; -o-transition: none}
.MathJax_Processing {visibility: hidden; position: fixed; width: 0; height: 0; overflow: hidden}
.MathJax_Processed {display: none!important}
.MathJax_ExBox {display: block!important; overflow: hidden; width: 1px; height: 60ex; min-height: 0; max-height: none}
.MathJax .MathJax_EmBox {display: block!important; overflow: hidden; width: 1px; height: 60em; min-height: 0; max-height: none}
.MathJax_LineBox {display: table!important}
.MathJax_LineBox span {display: table-cell!important; width: 10000em!important; min-width: 0; max-width: none; padding: 0; border: 0; margin: 0}
.MathJax .MathJax_HitBox {cursor: text; background: white; opacity: 0; filter: alpha(opacity=0)}
.MathJax .MathJax_HitBox * {filter: none; opacity: 1; background: transparent}
#MathJax_Tooltip * {filter: none; opacity: 1; background: transparent}
@font-face {font-family: MathJax_Main; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Main-Regular.woff?V=2.7.1') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Main-Regular.otf?V=2.7.1') format('opentype')}
@font-face {font-family: MathJax_Main-bold; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Main-Bold.woff?V=2.7.1') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Main-Bold.otf?V=2.7.1') format('opentype')}
@font-face {font-family: MathJax_Main-italic; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Main-Italic.woff?V=2.7.1') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Main-Italic.otf?V=2.7.1') format('opentype')}
@font-face {font-family: MathJax_Math-italic; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Math-Italic.woff?V=2.7.1') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Math-Italic.otf?V=2.7.1') format('opentype')}
@font-face {font-family: MathJax_Caligraphic; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Caligraphic-Regular.woff?V=2.7.1') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Caligraphic-Regular.otf?V=2.7.1') format('opentype')}
@font-face {font-family: MathJax_Size1; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Size1-Regular.woff?V=2.7.1') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Size1-Regular.otf?V=2.7.1') format('opentype')}
@font-face {font-family: MathJax_Size2; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Size2-Regular.woff?V=2.7.1') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Size2-Regular.otf?V=2.7.1') format('opentype')}
@font-face {font-family: MathJax_Size3; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Size3-Regular.woff?V=2.7.1') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Size3-Regular.otf?V=2.7.1') format('opentype')}
@font-face {font-family: MathJax_Size4; src: url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/woff/MathJax_Size4-Regular.woff?V=2.7.1') format('woff'), url('https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/fonts/HTML-CSS/TeX/otf/MathJax_Size4-Regular.otf?V=2.7.1') format('opentype')}
.MathJax .noError {vertical-align: ; font-size: 90%; text-align: left; color: black; padding: 1px 3px; border: 1px solid}
</style><script src="./Tutorial_Basics - MEEP Documentation_files/l.js(2).download"></script><script src="./Tutorial_Basics - MEEP Documentation_files/l.js(3).download"></script></head>

<body class="wy-body-for-nav" role="document"><div style="visibility: hidden; overflow: hidden; position: absolute; top: 0px; height: 1px; width: auto; padding: 0px; border: 0px; margin: 0px; text-align: left; text-indent: 0px; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal;"><div id="MathJax_Hidden"></div></div><div id="MathJax_Message" style="display: none;"></div>

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="https://meep.readthedocs.io/en/latest/" class="icon icon-home"> MEEP Documentation</a>
        <div role="search">
  <form id="rtd-search-form" class="wy-form" action="https://meep.readthedocs.io/en/latest/search.html" method="get">
    <input type="text" name="q" placeholder="Search docs">
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="https://meep.readthedocs.io/en/latest/">Manual</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="https://meep.readthedocs.io/en/latest/Introduction/">Introduction</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="https://meep.readthedocs.io/en/latest/Download/">Download</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="https://meep.readthedocs.io/en/latest/FAQ/">FAQ</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="https://meep.readthedocs.io/en/latest/Installation/">Installation</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="https://meep.readthedocs.io/en/latest/Build_From_Source/">Build From Source</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="https://meep.readthedocs.io/en/latest/Acknowledgements/">Acknowledgements</a>
	    </li>
          
            <li class="toctree-l1">
		
    <a class="" href="https://meep.readthedocs.io/en/latest/License_and_Copyright/">License and Copyright</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Features</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="https://meep.readthedocs.io/en/latest/Materials/">Materials</a>
                </li>
                <li class="">
                    
    <a class="" href="https://meep.readthedocs.io/en/latest/Subpixel_Smoothing/">Subpixel Smoothing</a>
                </li>
                <li class="">
                    
    <a class="" href="https://meep.readthedocs.io/en/latest/Exploiting_Symmetry/">Exploiting Symmetry</a>
                </li>
                <li class="">
                    
    <a class="" href="https://meep.readthedocs.io/en/latest/Cylindrical_Coordinates/">Cylindrical Coordinates</a>
                </li>
                <li class="">
                    
    <a class="" href="https://meep.readthedocs.io/en/latest/Perfectly_Matched_Layer/">Perfectly Matched Layers</a>
                </li>
                <li class="">
                    
    <a class="" href="https://meep.readthedocs.io/en/latest/Parallel_Meep/">Parallel Meep</a>
                </li>
                <li class="">
                    
    <a class="" href="https://meep.readthedocs.io/en/latest/Synchronizing_the_Magnetic_and_Electric_Fields/">Synchronizing the Magnetic and Electric Fields</a>
                </li>
                <li class="">
                    
    <a class="" href="https://meep.readthedocs.io/en/latest/Mode_Decomposition/">Mode Decomposition</a>
                </li>
                <li class="">
                    
    <a class="" href="https://meep.readthedocs.io/en/latest/Field_Functions/">Field Functions</a>
                </li>
                <li class="">
                    
    <a class="" href="https://meep.readthedocs.io/en/latest/The_Run_Function_Is_Not_A_Loop/">The Run Function is Not a Loop</a>
                </li>
                <li class="">
                    
    <a class="" href="https://meep.readthedocs.io/en/latest/Yee_Lattice/">Yee Lattice</a>
                </li>
                <li class="">
                    
    <a class="" href="https://meep.readthedocs.io/en/latest/Units_and_Nonlinearity/">Units and Nonlinearity</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Python Interface</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="https://meep.readthedocs.io/en/latest/Python_User_Interface/">User Interface</a>
                </li>
                <li class="">
                    
    <a class="" href="https://meep.readthedocs.io/en/latest/Python_Developer_Information/">Developer Information</a>
                </li>
                <li class=" current">
                    
    <a class="current" href="https://meep.readthedocs.io/en/latest/Python_Tutorials/Basics/">Tutorial/Basics</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="https://meep.readthedocs.io/en/latest/Python_Tutorials/Basics/#the-meep-library">The Meep Library</a></li>
    

    <li class="toctree-l3"><a href="https://meep.readthedocs.io/en/latest/Python_Tutorials/Basics/#fields-in-a-waveguide">Fields in a Waveguide</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="https://meep.readthedocs.io/en/latest/Python_Tutorials/Basics/#a-straight-waveguide">A Straight Waveguide</a></li>
        
            <li><a class="toctree-l4" href="https://meep.readthedocs.io/en/latest/Python_Tutorials/Basics/#a-90-bend">A 90° Bend</a></li>
        
        </ul>
    

    <li class="toctree-l3"><a href="https://meep.readthedocs.io/en/latest/Python_Tutorials/Basics/#transmittance-spectrum-of-a-waveguide-bend">Transmittance Spectrum of a Waveguide Bend</a></li>
    

    <li class="toctree-l3"><a href="https://meep.readthedocs.io/en/latest/Python_Tutorials/Basics/#angular-reflectance-spectrum-of-a-planar-interface">Angular Reflectance Spectrum of a Planar Interface</a></li>
    

    <li class="toctree-l3"><a href="https://meep.readthedocs.io/en/latest/Python_Tutorials/Basics/#modes-of-a-ring-resonator">Modes of a Ring Resonator</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="https://meep.readthedocs.io/en/latest/Python_Tutorials/Basics/#exploiting-symmetry">Exploiting Symmetry</a></li>
        
        </ul>
    

    <li class="toctree-l3"><a href="https://meep.readthedocs.io/en/latest/Python_Tutorials/Basics/#visualizing-3d-structures">Visualizing 3d Structures</a></li>
    

    </ul>
                </li>
                <li class="">
                    
    <a class="" href="https://meep.readthedocs.io/en/latest/Python_Tutorials/Ring_Resonator_in_Cylindrical_Coordinates/">Tutorial/Ring Resonator in Cylindrical Coordinates</a>
                </li>
                <li class="">
                    
    <a class="" href="https://meep.readthedocs.io/en/latest/Python_Tutorials/Resonant_Modes_and_Transmission_in_a_Waveguide_Cavity/">Tutorial/Resonant Modes and Transmission in a Waveguide Cavity</a>
                </li>
                <li class="">
                    
    <a class="" href="https://meep.readthedocs.io/en/latest/Python_Tutorials/Material_Dispersion/">Tutorial/Material Dispersion</a>
                </li>
                <li class="">
                    
    <a class="" href="https://meep.readthedocs.io/en/latest/Python_Tutorials/Third_Harmonic_Generation/">Tutorial/Third Harmonic Generation</a>
                </li>
                <li class="">
                    
    <a class="" href="https://meep.readthedocs.io/en/latest/Python_Tutorials/Near_to_Far_Field_Spectra/">Tutorial/Near-to-Far Field Spectra</a>
                </li>
                <li class="">
                    
    <a class="" href="https://meep.readthedocs.io/en/latest/Python_Tutorials/Local_Density_of_States/">Tutorial/Local Density of States</a>
                </li>
                <li class="">
                    
    <a class="" href="https://meep.readthedocs.io/en/latest/Python_Tutorials/Optical_Forces/">Tutorial/Optical Forces</a>
                </li>
                <li class="">
                    
    <a class="" href="https://meep.readthedocs.io/en/latest/Python_Tutorials/Gyrotropic_Media/">Tutorial/Gyrotropic Media</a>
                </li>
                <li class="">
                    
    <a class="" href="https://meep.readthedocs.io/en/latest/Python_Tutorials/Multilevel_Atomic_Susceptibility/">Tutorial/Multilevel Atomic Susceptibility</a>
                </li>
                <li class="">
                    
    <a class="" href="https://meep.readthedocs.io/en/latest/Python_Tutorials/Frequency_Domain_Solver/">Tutorial/Frequency-Domain Solver</a>
                </li>
                <li class="">
                    
    <a class="" href="https://meep.readthedocs.io/en/latest/Python_Tutorials/Eigenmode_Source/">Tutorial/Eigenmode Source</a>
                </li>
                <li class="">
                    
    <a class="" href="https://meep.readthedocs.io/en/latest/Python_Tutorials/Mode_Decomposition/">Tutorial/Mode Decomposition</a>
                </li>
                <li class="">
                    
    <a class="" href="https://meep.readthedocs.io/en/latest/Python_Tutorials/GDSII_Import/">Tutorial/GDSII Import</a>
                </li>
                <li class="">
                    
    <a class="" href="https://meep.readthedocs.io/en/latest/Python_Tutorials/AdjointSolver/">Tutorial/Adjoint Solver</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Scheme Interface</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="https://meep.readthedocs.io/en/latest/Scheme_User_Interface/">User Interface</a>
                </li>
                <li class="">
                    
    <a class="" href="https://meep.readthedocs.io/en/latest/Scheme_Tutorials/Basics/">Tutorial/Basics</a>
                </li>
                <li class="">
                    
    <a class="" href="https://meep.readthedocs.io/en/latest/Scheme_Tutorials/Ring_Resonator_in_Cylindrical_Coordinates/">Tutorial/Ring Resonator in Cylindrical Coordinates</a>
                </li>
                <li class="">
                    
    <a class="" href="https://meep.readthedocs.io/en/latest/Scheme_Tutorials/Resonant_Modes_and_Transmission_in_a_Waveguide_Cavity/">Tutorial/Resonant Modes and Transmission in a Waveguide Cavity</a>
                </li>
                <li class="">
                    
    <a class="" href="https://meep.readthedocs.io/en/latest/Scheme_Tutorials/Material_Dispersion/">Tutorial/Material Dispersion</a>
                </li>
                <li class="">
                    
    <a class="" href="https://meep.readthedocs.io/en/latest/Scheme_Tutorials/Third_Harmonic_Generation/">Tutorial/Third Harmonic Generation</a>
                </li>
                <li class="">
                    
    <a class="" href="https://meep.readthedocs.io/en/latest/Scheme_Tutorials/Near_to_Far_Field_Spectra/">Tutorial/Near-to-Far Field Spectra</a>
                </li>
                <li class="">
                    
    <a class="" href="https://meep.readthedocs.io/en/latest/Scheme_Tutorials/Local_Density_of_States/">Tutorial/Local Density of States</a>
                </li>
                <li class="">
                    
    <a class="" href="https://meep.readthedocs.io/en/latest/Scheme_Tutorials/Optical_Forces/">Tutorial/Optical Forces</a>
                </li>
                <li class="">
                    
    <a class="" href="https://meep.readthedocs.io/en/latest/Scheme_Tutorials/Gyrotropic_Media/">Tutorial/Gyrotropic Media</a>
                </li>
                <li class="">
                    
    <a class="" href="https://meep.readthedocs.io/en/latest/Scheme_Tutorials/Multilevel_Atomic_Susceptibility/">Tutorial/Multilevel Atomic Susceptibility</a>
                </li>
                <li class="">
                    
    <a class="" href="https://meep.readthedocs.io/en/latest/Scheme_Tutorials/Frequency_Domain_Solver/">Tutorial/Frequency-Domain Solver</a>
                </li>
                <li class="">
                    
    <a class="" href="https://meep.readthedocs.io/en/latest/Scheme_Tutorials/Eigenmode_Source/">Tutorial/Eigenmode Source</a>
                </li>
                <li class="">
                    
    <a class="" href="https://meep.readthedocs.io/en/latest/Scheme_Tutorials/Mode_Decomposition/">Tutorial/Mode Decomposition</a>
                </li>
                <li class="">
                    
    <a class="" href="https://meep.readthedocs.io/en/latest/Scheme_Tutorials/Casimir_Forces/">Tutorial/Casimir Forces</a>
                </li>
                <li class="">
                    
    <a class="" href="https://meep.readthedocs.io/en/latest/Guile_and_Scheme_Information/">Guile and Scheme Information</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">C++ Interface</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="https://meep.readthedocs.io/en/latest/C++_Developer_Information/">Developer Information</a>
                </li>
                <li class="">
                    
    <a class="" href="https://meep.readthedocs.io/en/latest/Chunks_and_Symmetry/">Chunks and Symmetry</a>
                </li>
                <li class="">
                    
    <a class="" href="https://meep.readthedocs.io/en/latest/C++_Tutorial/">Tutorial/Basics</a>
                </li>
    </ul>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    <div id="rtd-zsttnqc5" class="ethical-rtd ethical-dark-theme"></div></nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="https://meep.readthedocs.io/en/latest/">MEEP Documentation</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="https://meep.readthedocs.io/en/latest/">Docs</a> »</li>
    
      
        
          <li>Python Interface »</li>
        
      
    
    <li>Tutorial/Basics</li>
    <li class="wy-breadcrumbs-aside">
      
        <a href="https://github.com/NanoComp/meep/edit/master/doc/docs/Python_Tutorials/Basics.md" class="icon icon-github"> Edit on GitHub</a>
      
    </li>
  </ul>
  <hr>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="python-tutorial">Python Tutorial</h1>
<hr>
<p>We'll go through several examples using the Python interface that demonstrate the process of computing fields, transmittance/reflectance spectra, and resonant modes. The examples are 1d or 2d calculations, simply because they are quicker than 3d and they illustrate most of the essential features. For more advanced functionality involving 3d computations with a focus on technology applications, see the <a href="http://www.simpetus.com/projects.html">Simpetus projects page</a>.</p>
<div class="toc"><span class="toctitle">Table of Contents</span><ul>
<li><a href="https://meep.readthedocs.io/en/latest/Python_Tutorials/Basics/#python-tutorial">Python Tutorial</a><ul>
<li><a href="https://meep.readthedocs.io/en/latest/Python_Tutorials/Basics/#the-meep-library">The Meep Library</a></li>
<li><a href="https://meep.readthedocs.io/en/latest/Python_Tutorials/Basics/#fields-in-a-waveguide">Fields in a Waveguide</a><ul>
<li><a href="https://meep.readthedocs.io/en/latest/Python_Tutorials/Basics/#a-straight-waveguide">A Straight Waveguide</a></li>
<li><a href="https://meep.readthedocs.io/en/latest/Python_Tutorials/Basics/#a-90-bend">A 90° Bend</a><ul>
<li><a href="https://meep.readthedocs.io/en/latest/Python_Tutorials/Basics/#output-tips-and-tricks">Output Tips and Tricks</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="https://meep.readthedocs.io/en/latest/Python_Tutorials/Basics/#transmittance-spectrum-of-a-waveguide-bend">Transmittance Spectrum of a Waveguide Bend</a></li>
<li><a href="https://meep.readthedocs.io/en/latest/Python_Tutorials/Basics/#angular-reflectance-spectrum-of-a-planar-interface">Angular Reflectance Spectrum of a Planar Interface</a></li>
<li><a href="https://meep.readthedocs.io/en/latest/Python_Tutorials/Basics/#modes-of-a-ring-resonator">Modes of a Ring Resonator</a><ul>
<li><a href="https://meep.readthedocs.io/en/latest/Python_Tutorials/Basics/#exploiting-symmetry">Exploiting Symmetry</a></li>
</ul>
</li>
<li><a href="https://meep.readthedocs.io/en/latest/Python_Tutorials/Basics/#visualizing-3d-structures">Visualizing 3d Structures</a></li>
</ul>
</li>
</ul>
</div>
<h2 id="the-meep-library">The Meep Library</h2>
<p>Meep simulations are Python scripts which involve specifying the device geometry, materials, current sources, monitor fields, and everything else necessary to set up a calculation. A Python script provides the flexibility to customize the simulation for practically any application particularly those involving parameter sweeps and optimization. Python libraries such as <a href="http://www.numpy.org/">NumPy</a>, <a href="https://www.scipy.org/">SciPy</a>, and <a href="https://matplotlib.org/">Matplotlib</a> can be used to augment the simulation functionality and will also be demonstrated. Much of the functionality of the low-level C++ interface has been abstracted in Python which means that you don't need to be an experienced programmer to set up simulations. Reasonable defaults are available where necessary.</p>
<p>Executing Meep simulations is normally done at the Unix command line as follows:</p>
<pre><code class="sh hljs bash"> unix% python foo.py &gt;&amp; foo.out
</code></pre>

<p>which reads the Python script <code>foo.py</code> and executes it, saving the output to the file <code>foo.out</code>. If you want to set up simulations in interactive mode where you can type commands and see the results immediately, you will need to use either <a href="http://ipython.org/">IPython</a> via a shell terminal or a <a href="https://jupyter.org/">Jupyter notebook</a> via a browser. If you use one of these approaches, you can paste in the commands from the tutorial as you follow along and see what they do.</p>
<h2 id="fields-in-a-waveguide">Fields in a Waveguide</h2>
<p>For our first example, let's examine the field pattern excited by a localized <a href="https://en.wikipedia.org/wiki/Continuous_wave">CW</a> source in a waveguide — first straight, then bent. The waveguide will have frequency-independent ε=12 and width 1 μm. The unit length in this example is 1 μm. See also <a href="https://meep.readthedocs.io/en/latest/Introduction/#units-in-meep">Units</a>.</p>
<h3 id="a-straight-waveguide">A Straight Waveguide</h3>
<p>The simulation script is in <a href="https://github.com/NanoComp/meep/blob/master/python/examples/straight-waveguide.py">examples/straight-waveguide.py</a>. The notebook is <a href="https://nbviewer.jupyter.org/github/NanoComp/meep/blob/master/python/examples/straight-waveguide.ipynb">examples/straight-waveguide.ipynb</a>.</p>
<p>The first thing to do always is to load the Meep library:</p>
<pre><code class="py hljs python"><span class="hljs-keyword">import</span> meep <span class="hljs-keyword">as</span> mp
</code></pre>

<p>We can begin specifying each of the simulation objects starting with the computational cell. We're going to put a source at one end and watch the fields propagate down the waveguide in the <em>x</em> direction, so let's use a cell of length 16 μm in the <em>x</em> direction to give it some distance to propagate. In the <em>y</em> direction, we just need enough room so that the boundaries do not affect the waveguide mode; let's give it a size of 8 μm.</p>
<pre><code class="py hljs python">cell = mp.Vector3(<span class="hljs-number">16</span>,<span class="hljs-number">8</span>,<span class="hljs-number">0</span>)
</code></pre>

<p>The <code>Vector3</code> object stores the size of the cell in each of the three coordinate directions. This is a 2d cell in <em>x</em> and <em>y</em> where the <em>z</em> direction has size 0.</p>
<p>Next we add the waveguide. Most commonly, the device structure is specified by a set of <a href="https://meep.readthedocs.io/en/latest/Python_User_Interface/#geometricobject"><code>GeometricObject</code>s</a> stored in the <code>geometry</code> object.</p>
<pre><code class="py hljs python">geometry = [mp.Block(mp.Vector3(mp.inf,<span class="hljs-number">1</span>,mp.inf),
                     center=mp.Vector3(),
                     material=mp.Medium(epsilon=<span class="hljs-number">12</span>))]
</code></pre>

<p>The waveguide is specified by a <code>Block</code> (parallelepiped) of size <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-1-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x221E;&lt;/mi&gt;&lt;mo&gt;&amp;#x00D7;&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;&amp;#x00D7;&lt;/mo&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x221E;&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-1" style="width: 5.772em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.917em; height: 0px; font-size: 117%;"><span style="position: absolute; clip: rect(1.445em, 1004.86em, 2.407em, -999.997em); top: -2.241em; left: 0em;"><span class="mrow" id="MathJax-Span-2"><span class="mi" id="MathJax-Span-3" style="font-family: MathJax_Main;">∞</span><span class="mo" id="MathJax-Span-4" style="font-family: MathJax_Main; padding-left: 0.216em;">×</span><span class="mn" id="MathJax-Span-5" style="font-family: MathJax_Main; padding-left: 0.216em;">1</span><span class="mo" id="MathJax-Span-6" style="font-family: MathJax_Main; padding-left: 0.216em;">×</span><span class="mi" id="MathJax-Span-7" style="font-family: MathJax_Main; padding-left: 0.216em;">∞</span></span><span style="display: inline-block; width: 0px; height: 2.246em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi mathvariant="normal">∞</mi><mo>×</mo><mn>1</mn><mo>×</mo><mi mathvariant="normal">∞</mi></math></span></span><script type="math/tex" id="MathJax-Element-1">\infty \times 1 \times \infty</script>, with <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-2-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;&amp;#x3B5;&lt;/mo&gt;&lt;/mrow&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;12&lt;/mn&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-8" style="width: 3.261em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.78em; height: 0px; font-size: 117%;"><span style="position: absolute; clip: rect(1.445em, 1002.73em, 2.407em, -999.997em); top: -2.241em; left: 0em;"><span class="mrow" id="MathJax-Span-9"><span class="texatom" id="MathJax-Span-10"><span class="mrow" id="MathJax-Span-11"><span class="mo" id="MathJax-Span-12" style="font-family: MathJax_Math-italic;">ε</span></span></span><span class="mo" id="MathJax-Span-13" style="font-family: MathJax_Main; padding-left: 0.27em;">=</span><span class="mn" id="MathJax-Span-14" style="font-family: MathJax_Main; padding-left: 0.27em;">12</span></span><span style="display: inline-block; width: 0px; height: 2.246em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mo>ε</mo></mrow><mo>=</mo><mn>12</mn></math></span></span><script type="math/tex" id="MathJax-Element-2">ε=12</script>, centered at (0,0) which is the center of the cell. By default, any place where there are no objects there is air (<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-3-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;&amp;#x3B5;&lt;/mo&gt;&lt;/mrow&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-15" style="width: 2.727em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.3em; height: 0px; font-size: 117%;"><span style="position: absolute; clip: rect(1.445em, 1002.25em, 2.407em, -999.997em); top: -2.241em; left: 0em;"><span class="mrow" id="MathJax-Span-16"><span class="texatom" id="MathJax-Span-17"><span class="mrow" id="MathJax-Span-18"><span class="mo" id="MathJax-Span-19" style="font-family: MathJax_Math-italic;">ε</span></span></span><span class="mo" id="MathJax-Span-20" style="font-family: MathJax_Main; padding-left: 0.27em;">=</span><span class="mn" id="MathJax-Span-21" style="font-family: MathJax_Main; padding-left: 0.27em;">1</span></span><span style="display: inline-block; width: 0px; height: 2.246em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mo>ε</mo></mrow><mo>=</mo><mn>1</mn></math></span></span><script type="math/tex" id="MathJax-Element-3">ε=1</script>), although this can be changed by setting the <code>default_material</code> variable. The resulting structure is shown below.</p>
<p></p><center><img alt="" src="./Tutorial_Basics - MEEP Documentation_files/Python-Tutorial-wvg-straight-eps-000000.00.png"></center><p></p>
<p>We have the structure and need to specify the current sources using the <code>sources</code> object. The simplest thing is to add a single point source <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-4-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;J&lt;/mi&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-22" style="width: 1.124em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.964em; height: 0px; font-size: 117%;"><span style="position: absolute; clip: rect(1.338em, 1000.96em, 2.513em, -999.997em); top: -2.188em; left: 0em;"><span class="mrow" id="MathJax-Span-23"><span class="msubsup" id="MathJax-Span-24"><span style="display: inline-block; position: relative; width: 0.964em; height: 0px;"><span style="position: absolute; clip: rect(3.154em, 1000.64em, 4.169em, -999.997em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-25" style="font-family: MathJax_Math-italic;">J<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.056em;"></span></span><span style="display: inline-block; width: 0px; height: 4.009em;"></span></span><span style="position: absolute; top: -3.843em; left: 0.537em;"><span class="mi" id="MathJax-Span-26" style="font-size: 70.7%; font-family: MathJax_Math-italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span style="display: inline-block; width: 0px; height: 4.009em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.193em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>J</mi><mi>z</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-4">J_z</script>:</p>
<pre><code class="py hljs python">sources = [mp.Source(mp.ContinuousSource(frequency=<span class="hljs-number">0.15</span>),
                     component=mp.Ez,
                     center=mp.Vector3(-<span class="hljs-number">7</span>,<span class="hljs-number">0</span>))]
</code></pre>

<p>We gave the source a frequency of 0.15, and specified a <a href="https://meep.readthedocs.io/en/latest/Python_User_Interface/#continuoussource"><code>ContinuousSource</code></a> which is just a fixed-frequency sinusoid <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-5-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;exp&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mi&gt;&amp;#x03C9;&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-27" style="width: 5.184em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.436em; height: 0px; font-size: 117%;"><span style="position: absolute; clip: rect(1.338em, 1004.33em, 2.674em, -999.997em); top: -2.241em; left: 0em;"><span class="mrow" id="MathJax-Span-28"><span class="mi" id="MathJax-Span-29" style="font-family: MathJax_Main;">exp</span><span class="mo" id="MathJax-Span-30"></span><span class="mo" id="MathJax-Span-31" style="font-family: MathJax_Main;">(</span><span class="mo" id="MathJax-Span-32" style="font-family: MathJax_Main;">−</span><span class="mi" id="MathJax-Span-33" style="font-family: MathJax_Math-italic;">i</span><span class="mi" id="MathJax-Span-34" style="font-family: MathJax_Math-italic;">ω</span><span class="mi" id="MathJax-Span-35" style="font-family: MathJax_Math-italic;">t</span><span class="mo" id="MathJax-Span-36" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.246em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.316em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>exp</mi><mo>⁡</mo><mo stretchy="false">(</mo><mo>−</mo><mi>i</mi><mi>ω</mi><mi>t</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-5">\exp(-i \omega t)</script> that by default is turned on at <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-6-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mn&gt;0&lt;/mn&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-37" style="width: 2.567em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.193em; height: 0px; font-size: 117%;"><span style="position: absolute; clip: rect(1.445em, 1002.14em, 2.407em, -999.997em); top: -2.241em; left: 0em;"><span class="mrow" id="MathJax-Span-38"><span class="mi" id="MathJax-Span-39" style="font-family: MathJax_Math-italic;">t</span><span class="mo" id="MathJax-Span-40" style="font-family: MathJax_Main; padding-left: 0.27em;">=</span><span class="mn" id="MathJax-Span-41" style="font-family: MathJax_Main; padding-left: 0.27em;">0</span></span><span style="display: inline-block; width: 0px; height: 2.246em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>t</mi><mo>=</mo><mn>0</mn></math></span></span><script type="math/tex" id="MathJax-Element-6">t=0</script>. Recall that, in <a href="https://meep.readthedocs.io/en/latest/Introduction/#units-in-meep">Meep units</a>, frequency is specified in units of 2πc, which is equivalent to the inverse of the vacuum wavelength. Thus, 0.15 corresponds to a vacuum wavelength of about 1/0.15=6.67 μm, or a wavelength of about 2 μm in the ε=12 material — thus, our waveguide is half a wavelength wide, which should hopefully make it single mode. In fact, the cutoff for single-mode behavior in this waveguide is analytically solvable, and corresponds to a frequency of 1/2√11 or roughly 0.15076. Note also that to specify a J<sub>z</sub>, we specify a component <code>Ez</code> (e.g., if we wanted a magnetic current, we would specify <code>Hx</code>, <code>Hy</code>, or <code>Hz</code>). The current is located at (-7,0), which is 1 μm to the right of the left edge of the cell — we always want to leave a little space between sources and the cell boundaries, to keep the boundary conditions from interfering with them.</p>
<p>As for boundary conditions, we want to add absorbing boundaries around our cell. Absorbing boundaries in Meep are handled by <a href="https://meep.readthedocs.io/en/latest/Perfectly_Matched_Layer/">perfectly matched layers</a> (PML) —  which aren't really a boundary condition at all, but rather a fictitious absorbing material added around the edges of the cell. To add an absorbing layer of thickness 1 μm around all sides of the cell, we do:</p>
<pre><code class="py hljs python">pml_layers = [mp.PML(<span class="hljs-number">1.0</span>)]
</code></pre>

<p><code>pml_layers</code> is a set of <a href="https://meep.readthedocs.io/en/latest/Python_User_Interface/#pml"><code>PML</code></a> objects — you may have more than one <code>PML</code> object if you want PML layers only on certain sides of the cell, e.g. <code>mp.PML(thickness=1.0,direction=mp.X,side=mp.high)</code> specifies a PML layer on only the <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-7-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo&gt;+&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-42" style="width: 1.605em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.338em; height: 0px; font-size: 117%;"><span style="position: absolute; clip: rect(1.498em, 1001.28em, 2.513em, -999.997em); top: -2.241em; left: 0em;"><span class="mrow" id="MathJax-Span-43"><span class="mo" id="MathJax-Span-44" style="font-family: MathJax_Main;">+</span><span class="mi" id="MathJax-Span-45" style="font-family: MathJax_Math-italic;">x</span></span><span style="display: inline-block; width: 0px; height: 2.246em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.184em; border-left: 0px solid; width: 0px; height: 0.878em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>+</mo><mi>x</mi></math></span></span><script type="math/tex" id="MathJax-Element-7">+x</script> side. An important point: <strong>the PML layer is <em>inside</em> the cell</strong>, overlapping whatever objects you have there. So, in this case our PML overlaps our waveguide, which is what we want so that it will properly absorb waveguide modes. The finite thickness of the PML is important to reduce numerical reflections. For more information, see <a href="https://meep.readthedocs.io/en/latest/Perfectly_Matched_Layer/">Perfectly Matched Layer</a>.</p>
<p>Meep will discretize this structure in space and time, and that is specified by a single variable, <code>resolution</code>, that gives the number of pixels per distance unit. We'll set this resolution to 10 pixels/μm, which corresponds to around 67 pixels/wavelength, or around 20 pixels/wavelength in the high-index material. In general, at least 8 pixels/wavelength in the highest dielectric is a good idea. This will give us a 160×80 cell.</p>
<pre><code class="py hljs python">resolution = <span class="hljs-number">10</span>
</code></pre>

<p>The final object to specify is <a href="https://meep.readthedocs.io/en/latest/Python_User_Interface/#the-simulation-class"><code>Simulation</code></a> which is based on all the previously defined objects.</p>
<pre><code class="py hljs python">sim = mp.Simulation(cell_size=cell,
                    boundary_layers=pml_layers,
                    geometry=geometry,
                    sources=sources,
                    resolution=resolution)
</code></pre>

<p>We are ready to run the simulation. We time step the fields until a time of 200:</p>
<pre><code class="py hljs python">sim.run(until=<span class="hljs-number">200</span>)
</code></pre>

<p>It should finish in less than a second. We can analyze and visualize the fields with the NumPy and Matplotlib libraries:</p>
<pre><code class="py hljs python"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np
<span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt
</code></pre>

<p>We will first create an image of the dielectric function ε. This involves obtaining a slice of the data using the <a href="https://meep.readthedocs.io/en/latest/Python_User_Interface/#array-slices"><code>get_array</code></a> routine which outputs to a NumPy array and then display the results.</p>
<pre><code class="py hljs python">eps_data = sim.get_array(center=mp.Vector3(), size=cell, component=mp.Dielectric)
plt.figure()
plt.imshow(eps_data.transpose(), interpolation=<span class="hljs-string">'spline36'</span>, cmap=<span class="hljs-string">'binary'</span>)
plt.axis(<span class="hljs-string">'off'</span>)
plt.show()
</code></pre>

<p>Next, we create an image of the scalar electric field E<sub>z</sub> by overlaying the dielectric function. We use the "RdBu" <a href="https://matplotlib.org/examples/color/colormaps_reference.html">colormap</a> which goes from dark red (negative) to white (zero) to dark blue (positive).</p>
<pre><code class="py hljs python">ez_data = sim.get_array(center=mp.Vector3(), size=cell, component=mp.Ez)
plt.figure()
plt.imshow(eps_data.transpose(), interpolation=<span class="hljs-string">'spline36'</span>, cmap=<span class="hljs-string">'binary'</span>)
plt.imshow(ez_data.transpose(), interpolation=<span class="hljs-string">'spline36'</span>, cmap=<span class="hljs-string">'RdBu'</span>, alpha=<span class="hljs-number">0.9</span>)
plt.axis(<span class="hljs-string">'off'</span>)
plt.show()
</code></pre>

<p></p><center><img alt="" src="./Tutorial_Basics - MEEP Documentation_files/Python-Tutorial-wvg-straight-ez-000200.00.png"></center><p></p>
<p>We see that the the source has excited the waveguide mode but has also excited radiating fields propagating away from the waveguide. At the boundaries, the field quickly goes to zero due to the PML.</p>
<h3 id="a-90-bend">A 90° Bend</h3>
<p>We'll start a new simulation where we look at the fields propagating through a waveguide bend, and we'll do a couple of other things differently as well. The simulation script is in <a href="https://github.com/NanoComp/meep/blob/master/python/examples/bent-waveguide.py">examples/bent-waveguide.py</a>; the notebook is <a href="https://nbviewer.jupyter.org/github/NanoComp/meep/blob/master/python/examples/bent-waveguide.ipynb">examples/bent-waveguide.ipynb</a>. As usual, the first thing to do is to load the Meep library:</p>
<pre><code class="py hljs python"><span class="hljs-keyword">import</span> meep <span class="hljs-keyword">as</span> mp
</code></pre>

<p>Then let's set up the bent waveguide in a slightly larger cell:</p>
<pre><code class="py hljs python">cell = mp.Vector3(<span class="hljs-number">16</span>,<span class="hljs-number">16</span>,<span class="hljs-number">0</span>)
geometry = [mp.Block(mp.Vector3(<span class="hljs-number">12</span>,<span class="hljs-number">1</span>,mp.inf),
                     center=mp.Vector3(-<span class="hljs-number">2.5</span>,-<span class="hljs-number">3.5</span>),
                     material=mp.Medium(epsilon=<span class="hljs-number">12</span>)),
            mp.Block(mp.Vector3(<span class="hljs-number">1</span>,<span class="hljs-number">12</span>,mp.inf),
                     center=mp.Vector3(<span class="hljs-number">3.5</span>,<span class="hljs-number">2</span>),
                     material=mp.Medium(epsilon=<span class="hljs-number">12</span>))]
pml_layers = [mp.PML(<span class="hljs-number">1.0</span>)]
resolution = <span class="hljs-number">10</span>
</code></pre>

<p>Note that we have <em>two</em> blocks, both off-center to produce the bent waveguide structure pictured below. As illustrated in the figure, the origin (0,0) of the coordinate system is at the center of the cell, with positive <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-8-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-46" style="width: 0.59em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.483em; height: 0px; font-size: 117%;"><span style="position: absolute; clip: rect(1.605em, 1000.48em, 2.567em, -999.997em); top: -2.188em; left: 0em;"><span class="mrow" id="MathJax-Span-47"><span class="mi" id="MathJax-Span-48" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.193em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 0.878em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>y</mi></math></span></span><script type="math/tex" id="MathJax-Element-8">y</script> being downwards, and thus the block of size 12<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-9-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo&gt;&amp;#x00D7;&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-49" style="width: 0.964em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.804em; height: 0px; font-size: 117%;"><span style="position: absolute; clip: rect(1.605em, 1000.64em, 2.407em, -999.997em); top: -2.241em; left: 0em;"><span class="mrow" id="MathJax-Span-50"><span class="mo" id="MathJax-Span-51" style="font-family: MathJax_Main;">×</span></span><span style="display: inline-block; width: 0px; height: 2.246em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>×</mo></math></span></span><script type="math/tex" id="MathJax-Element-9">\times</script>1 is centered at (-2,-3.5). Also shown in green is the source plane at <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-10-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;7&lt;/mn&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-52" style="width: 3.689em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.154em; height: 0px; font-size: 117%;"><span style="position: absolute; clip: rect(1.392em, 1003.15em, 2.513em, -999.997em); top: -2.241em; left: 0em;"><span class="mrow" id="MathJax-Span-53"><span class="mi" id="MathJax-Span-54" style="font-family: MathJax_Math-italic;">x</span><span class="mo" id="MathJax-Span-55" style="font-family: MathJax_Main; padding-left: 0.27em;">=</span><span class="mo" id="MathJax-Span-56" style="font-family: MathJax_Main; padding-left: 0.27em;">−</span><span class="mn" id="MathJax-Span-57" style="font-family: MathJax_Main;">7</span></span><span style="display: inline-block; width: 0px; height: 2.246em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.184em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>x</mi><mo>=</mo><mo>−</mo><mn>7</mn></math></span></span><script type="math/tex" id="MathJax-Element-10">x=-7</script> which is shifted to <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-11-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;3.5&lt;/mn&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-58" style="width: 4.543em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.849em; height: 0px; font-size: 117%;"><span style="position: absolute; clip: rect(1.445em, 1003.79em, 2.62em, -999.997em); top: -2.241em; left: 0em;"><span class="mrow" id="MathJax-Span-59"><span class="mi" id="MathJax-Span-60" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-61" style="font-family: MathJax_Main; padding-left: 0.27em;">=</span><span class="mo" id="MathJax-Span-62" style="font-family: MathJax_Main; padding-left: 0.27em;">−</span><span class="mn" id="MathJax-Span-63" style="font-family: MathJax_Main;">3.5</span></span><span style="display: inline-block; width: 0px; height: 2.246em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.128em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>y</mi><mo>=</mo><mo>−</mo><mn>3.5</mn></math></span></span><script type="math/tex" id="MathJax-Element-11">y=-3.5</script> so that it is still inside the waveguide.</p>
<p></p><center><img alt="" src="./Tutorial_Basics - MEEP Documentation_files/Tutorial-wvg-bent-eps-000000.00.png"></center><p></p>
<p>There are a couple of items to note. First, a point source does not couple very efficiently to the waveguide mode, so we'll expand this into a line source, centered at (-7,-3.5), with the same width as the waveguide by adding a <code>size</code> property to the source. This is shown in green in the figure above. An <a href="https://meep.readthedocs.io/en/latest/Python_User_Interface/#eigenmodesource">eigenmode source</a> can also be used which is described in <a href="https://meep.readthedocs.io/en/latest/Python_Tutorials/Optical_Forces/">Tutorial/Optical Forces</a>. Second, instead of turning the source on suddenly at t=0 which excites many other frequencies because of the discontinuity, we will ramp it on slowly. Meep uses a hyperbolic tangent (tanh) turn-on function over a time proportional to the <code>width</code> of 20 time units which is a little over three periods. Finally, just for variety, we'll specify the vacuum wavelength instead of the frequency; again, we'll use a wavelength such that the waveguide is half a wavelength wide.</p>
<pre><code class="py hljs python">sources = [mp.Source(mp.ContinuousSource(wavelength=<span class="hljs-number">2</span>*(<span class="hljs-number">11</span>**<span class="hljs-number">0.5</span>), width=<span class="hljs-number">20</span>),
                     component=mp.Ez,
                     center=mp.Vector3(-<span class="hljs-number">7</span>,-<span class="hljs-number">3.5</span>),
                     size=mp.Vector3(<span class="hljs-number">0</span>,<span class="hljs-number">1</span>))]
</code></pre>

<p>Finally, we'll run the simulation. The first set of arguments to the <code>run</code> routine specify fields to output or other kinds of analyses at each time step.</p>
<pre><code class="py hljs python">sim = mp.Simulation(cell_size=cell,
                    boundary_layers=pml_layers,
                    geometry=geometry,
                    sources=sources,
                    resolution=resolution)

sim.run(mp.at_beginning(mp.output_epsilon),
        mp.to_appended(<span class="hljs-string">"ez"</span>, mp.at_every(<span class="hljs-number">0.6</span>, mp.output_efield_z)),
        until=<span class="hljs-number">200</span>)
</code></pre>

<p>We are outputting the dielectric function ε but have wrapped its output function which would otherwise run at every time step in <code>at_beginning</code>, which does just what it says. There are <a href="https://meep.readthedocs.io/en/latest/Python_User_Interface/#run-and-step-functions">several other such functions</a> to modify the output behavior — and you can, of course, write your own, and in fact you can do any computation or output you want at any time during the time evolution and even modify the simulation while it is running.</p>
<p>Instead of running <code>output_efield_z</code> only at the end of the simulation, however, we run it at every 0.6 time units (about 10 times per period) via <code>mp.at_every(0.6, mp.output_efield_z)</code>. By itself, this would output a separate file for every different output time, but instead we'll use another feature to output to a <em>single</em> 3d HDF5 file, where the third dimension is time. <code>"ez"</code> determines the name of the output file, which will be called <code>ez.h5</code> if you are running interactively or will be prefixed with the name of the file name for a Python file (e.g. <code>tutorial-ez.h5</code> for <code>tutorial.py</code>). If we run <code>h5ls</code> on this file (a standard utility, included with HDF5, that lists the contents of the HDF5 file), we get:</p>
<pre><code class="sh hljs bash">unix% h5ls ez.h5
ez                       Dataset {<span class="hljs-number">160</span>, <span class="hljs-number">160</span>, <span class="hljs-number">333</span>/Inf}
</code></pre>

<p>That is, the file contains a single dataset <code>ez</code> that is a 160x160x333 array, where the last dimension is time. This is rather a large file, 66MB; later, we'll see ways to reduce this size if we only want images. We have a number of choices of how to output the fields. To output a single time slice, we can use the same <code>h5topng</code> command, but with an additional <code>-t</code> option to specify the time index: e.g. <code>h5topng -t 332</code> will output the last time slice, similar to before. Instead, let's create an animation of the fields as a function of time. First, we have to create images for <em>all</em> of the time slices:</p>
<pre><code class="sh hljs bash">unix% h5topng -t <span class="hljs-number">0</span>:<span class="hljs-number">332</span> -R -Zc dkbluered <span class="hljs-operator">-a</span> yarg -A eps-<span class="hljs-number">000000.00</span>.h5 ez.h5
</code></pre>

<p>This is similar to the command before with two new options: <code>-t 0:332</code> outputs images for <em>all</em> time indices from 0 to 332, i.e. all of the times, and the the <code>-R</code> flag tells h5topng to use a consistent color scale for every image (instead of scaling each image independently). Then, we have to convert these images into an animation in some format. For this, we'll use the free <a href="https://en.wikipedia.org/wiki/ImageMagick">ImageMagick</a> <code>convert</code> program and there are other tools that work as well.</p>
<pre><code class="sh hljs bash">unix%&nbsp;convert&nbsp;ez.t*.png&nbsp;ez.gif
</code></pre>

<p>We are using an animated GIF format for the output. This results in the following animation:</p>
<p></p><center><img alt="" src="./Tutorial_Basics - MEEP Documentation_files/Tutorial-wvg-ez.gif"></center><p></p>
<p>It is clear that the transmission around the bend is rather low for this frequency and structure — both large reflection and large radiation loss are clearly visible. Moreover, since we are operating just barely below the cutoff for single-mode behavior, we are able to excite a second <em>leaky</em> mode after the waveguide bend, whose second-order mode pattern (superimposed with the fundamental mode) is apparent in the animation. Below, we show a field snapshot from a simulation with a larger cell along the <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-12-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-64" style="width: 0.59em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.483em; height: 0px; font-size: 117%;"><span style="position: absolute; clip: rect(1.605em, 1000.48em, 2.567em, -999.997em); top: -2.188em; left: 0em;"><span class="mrow" id="MathJax-Span-65"><span class="mi" id="MathJax-Span-66" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.193em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 0.878em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>y</mi></math></span></span><script type="math/tex" id="MathJax-Element-12">y</script> direction, in which you can see that the second-order leaky mode decays away, leaving us with the fundamental mode propagating downward.</p>
<p></p><center><img alt="" src="./Tutorial_Basics - MEEP Documentation_files/Tutorial-wvg-bent2-ez-000300.00.png"></center><p></p>
<p>Instead of doing an animation, another interesting possibility is to make an image from a <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-13-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;&amp;#x00D7;&lt;/mo&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-67" style="width: 2.513em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.139em; height: 0px; font-size: 117%;"><span style="position: absolute; clip: rect(1.445em, 1002.09em, 2.407em, -999.997em); top: -2.241em; left: 0em;"><span class="mrow" id="MathJax-Span-68"><span class="mi" id="MathJax-Span-69" style="font-family: MathJax_Math-italic;">x</span><span class="mo" id="MathJax-Span-70" style="font-family: MathJax_Main; padding-left: 0.216em;">×</span><span class="mi" id="MathJax-Span-71" style="font-family: MathJax_Math-italic; padding-left: 0.216em;">t</span></span><span style="display: inline-block; width: 0px; height: 2.246em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.878em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>x</mi><mo>×</mo><mi>t</mi></math></span></span><script type="math/tex" id="MathJax-Element-13">x \times t</script> slice. To get the <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-14-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;3.5&lt;/mn&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-72" style="width: 4.543em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.849em; height: 0px; font-size: 117%;"><span style="position: absolute; clip: rect(1.445em, 1003.79em, 2.62em, -999.997em); top: -2.241em; left: 0em;"><span class="mrow" id="MathJax-Span-73"><span class="mi" id="MathJax-Span-74" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-75" style="font-family: MathJax_Main; padding-left: 0.27em;">=</span><span class="mo" id="MathJax-Span-76" style="font-family: MathJax_Main; padding-left: 0.27em;">−</span><span class="mn" id="MathJax-Span-77" style="font-family: MathJax_Main;">3.5</span></span><span style="display: inline-block; width: 0px; height: 2.246em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.128em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>y</mi><mo>=</mo><mo>−</mo><mn>3.5</mn></math></span></span><script type="math/tex" id="MathJax-Element-14">y=-3.5</script> slice, which gives us an image of the fields in the first waveguide branch as a function of time, we can use <code>get_array</code> in a step function to collect a slice for each time step:</p>
<pre><code class="python hljs">vals = []

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">get_slice</span><span class="hljs-params">(sim)</span>:</span>
    vals.append(sim.get_array(center=mp.Vector3(<span class="hljs-number">0</span>,-<span class="hljs-number">3.5</span>), size=mp.Vector3(<span class="hljs-number">16</span>,<span class="hljs-number">0</span>), component=mp.Ez))

sim.run(mp.at_beginning(mp.output_epsilon),
        mp.at_every(<span class="hljs-number">0.6</span>, get_slice),
        until=<span class="hljs-number">200</span>)

<span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt

plt.figure()
plt.imshow(vals, interpolation=<span class="hljs-string">'spline36'</span>, cmap=<span class="hljs-string">'RdBu'</span>)
plt.axis(<span class="hljs-string">'off'</span>)
plt.show()
</code></pre>

<p></p><center><img alt="" src="./Tutorial_Basics - MEEP Documentation_files/Python-Tutorial-wvg-bent-ez-tslice.png"></center><p></p>
<h4 id="output-tips-and-tricks">Output Tips and Tricks</h4>
<p>Above, we outputted the full 2d data slice at every 0.6 time units, resulting in a 69MB file. This is not large but you can imagine how big the output file would get if we were doing a 3d simulation, or even a larger 2d simulation — one can easily generate gigabytes of files, which is not only wasteful but is also slow. Instead, it is possible to output more efficiently if you know what you want to look at.</p>
<p>To create the movie above, all we really need are the <em>images</em> corresponding to each time. Images can be stored much more efficiently than raw arrays of numbers — to exploit this fact, Meep allows you to output PNG images instead of HDF5 files. In particular, instead of <code>output_efield_z</code> as above, we can use <code>mp.output_png(mp.Ez, "-Zc dkbluered")</code>, where Ez is the component to output and the <code>"-Zc</code> <code>dkbluered"</code> are options for <code>h5topng</code> of <a href="https://github.com/NanoComp/h5utils/blob/master/README.md">h5utils</a> which is the program that is actually used to create the image files. That is:</p>
<pre><code class="py hljs python">sim.run(mp.at_every(<span class="hljs-number">0.6</span> , mp.output_png(mp.Ez, <span class="hljs-string">"-Zc dkbluered"</span>)), until=<span class="hljs-number">200</span>)        
</code></pre>

<p>will output a PNG file file every 0.6 time units, which can then be combined with <code>convert</code> as above to create a movie. The movie will be similar to the one before, but not identical because of how the color scale is determined. Before, we used the <code>-R</code> option to make h5topng use a uniform color scale for all images, based on the minimum/maximum field values over <i>all</i> time steps. That is not possible because we output an image before knowing the field values at future time steps. Thus, what <code>output_png</code> does is to set its color scale based on the minimum/maximum field values from all <em>past</em> times — therefore, the color scale will slowly "ramp up" as the source turns on.</p>
<p>The above command outputs zillions of PNG files, and it is somewhat annoying to have them clutter up our working directory. Instead, we can add the following command before <code>run</code>:</p>
<pre><code class="py hljs python">sim.use_output_directory()
</code></pre>

<p>This will put <em>all</em> of the output files (.h5, .png, etcetera) into a newly-created subdirectory, called by default <code>filename-out/</code> if our Python script is <code>filename.py</code>.</p>
<p>What if we want to output an <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-15-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;&amp;#x00D7;&lt;/mo&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-78" style="width: 2.513em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.139em; height: 0px; font-size: 117%;"><span style="position: absolute; clip: rect(1.445em, 1002.09em, 2.407em, -999.997em); top: -2.241em; left: 0em;"><span class="mrow" id="MathJax-Span-79"><span class="mi" id="MathJax-Span-80" style="font-family: MathJax_Math-italic;">x</span><span class="mo" id="MathJax-Span-81" style="font-family: MathJax_Main; padding-left: 0.216em;">×</span><span class="mi" id="MathJax-Span-82" style="font-family: MathJax_Math-italic; padding-left: 0.216em;">t</span></span><span style="display: inline-block; width: 0px; height: 2.246em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.878em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>x</mi><mo>×</mo><mi>t</mi></math></span></span><script type="math/tex" id="MathJax-Element-15">x \times t</script> slice, as above? To do this, we only really wanted the values at <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-16-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;3.5&lt;/mn&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-83" style="width: 4.543em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.849em; height: 0px; font-size: 117%;"><span style="position: absolute; clip: rect(1.445em, 1003.79em, 2.62em, -999.997em); top: -2.241em; left: 0em;"><span class="mrow" id="MathJax-Span-84"><span class="mi" id="MathJax-Span-85" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-86" style="font-family: MathJax_Main; padding-left: 0.27em;">=</span><span class="mo" id="MathJax-Span-87" style="font-family: MathJax_Main; padding-left: 0.27em;">−</span><span class="mn" id="MathJax-Span-88" style="font-family: MathJax_Main;">3.5</span></span><span style="display: inline-block; width: 0px; height: 2.246em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.128em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>y</mi><mo>=</mo><mo>−</mo><mn>3.5</mn></math></span></span><script type="math/tex" id="MathJax-Element-16">y=-3.5</script>, and therefore we can exploit another powerful output feature — Meep allows us to output only <strong>a subset of the computational cell</strong>. This is done using the <code>in_volume</code> function, which like <code>at_every</code> and <code>to_appended</code> is another function that modifies the behavior of other output functions. In particular, we can do:</p>
<pre><code class="hljs stylus">sim.<span class="hljs-function"><span class="hljs-title">run</span><span class="hljs-params">(mp.in_volume(mp.Volume(mp.Vector3(<span class="hljs-number">0</span>,-<span class="hljs-number">3.5</span>)</span></span>, size=mp.<span class="hljs-function"><span class="hljs-title">Vector3</span><span class="hljs-params">(<span class="hljs-number">16</span>,<span class="hljs-number">0</span>)</span></span>), mp.<span class="hljs-function"><span class="hljs-title">to_appended</span><span class="hljs-params">(<span class="hljs-string">"ez-slice"</span>, mp.output_efield_z)</span></span>), until=<span class="hljs-number">200</span>)        
</code></pre>

<p>The first argument to <code>in_volume</code> is a volume which applies to all of the nested output functions. Note that <code>to_appended</code>, <code>at_every</code>, and <code>in_volume</code> are cumulative regardless of what order you put them in. This creates the output file <code>ez-slice.h5</code> which contains a dataset of size 162x330 corresponding to the desired <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-17-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mo&gt;&amp;#x00D7;&lt;/mo&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-89" style="width: 2.513em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.139em; height: 0px; font-size: 117%;"><span style="position: absolute; clip: rect(1.445em, 1002.09em, 2.407em, -999.997em); top: -2.241em; left: 0em;"><span class="mrow" id="MathJax-Span-90"><span class="mi" id="MathJax-Span-91" style="font-family: MathJax_Math-italic;">x</span><span class="mo" id="MathJax-Span-92" style="font-family: MathJax_Main; padding-left: 0.216em;">×</span><span class="mi" id="MathJax-Span-93" style="font-family: MathJax_Math-italic; padding-left: 0.216em;">t</span></span><span style="display: inline-block; width: 0px; height: 2.246em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.878em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>x</mi><mo>×</mo><mi>t</mi></math></span></span><script type="math/tex" id="MathJax-Element-17">x \times t</script> slice.</p>
<h2 id="transmittance-spectrum-of-a-waveguide-bend">Transmittance Spectrum of a Waveguide Bend</h2>
<p>We have computed the field patterns for light propagating around a waveguide bend. While this can be visually informative, the results are not quantitatively satisfying. We'd like to know exactly how much power makes it around the bend (<a href="https://en.wikipedia.org/wiki/Transmittance">transmittance</a>), how much is reflected (<a href="https://en.wikipedia.org/wiki/Reflectance">reflectance</a>), and how much is radiated away (scattered loss). How can we do this?</p>
<p>The basic principles are described in <a href="https://meep.readthedocs.io/en/latest/Introduction/#transmittancereflectance-spectra">Introduction</a>. The computation involves keeping track of the fields and their Fourier transform in a certain region, and from this computing the flux of electromagnetic energy as a function of ω. Moreover, we'll get an entire spectrum of the transmittance in a single run, by Fourier-transforming the response to a short pulse. However, in order to normalize the transmitted flux by the incident power to obtain the transmittance, we'll have to do <em>two</em> runs, one with and one without the bend (i.e., a straight waveguide).</p>
<p>The simulation script is in <a href="https://github.com/NanoComp/meep/blob/master/python/examples/bend-flux.py">examples/bend-flux.py</a>. The notebook is <a href="https://nbviewer.jupyter.org/github/NanoComp/meep/blob/master/python/examples/bend-flux.ipynb">examples/bend-flux.ipynb</a>.</p>
<pre><code class="py hljs python"><span class="hljs-keyword">import</span> meep <span class="hljs-keyword">as</span> mp
<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np
<span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt

resolution = <span class="hljs-number">10</span> <span class="hljs-comment"># pixels/um</span>

sx = <span class="hljs-number">16</span>  <span class="hljs-comment"># size of cell in X direction</span>
sy = <span class="hljs-number">32</span>  <span class="hljs-comment"># size of cell in Y direction</span>
cell = mp.Vector3(sx,sy,<span class="hljs-number">0</span>)

dpml = <span class="hljs-number">1.0</span>
pml_layers = [mp.PML(dpml)]
</code></pre>

<p>We'll also define a couple of parameters to set the width of the waveguide and the "padding" between it and the edge of the cell:</p>
<pre><code class="py hljs python">pad = <span class="hljs-number">4</span>  <span class="hljs-comment"># padding distance between waveguide and cell edge</span>
w = <span class="hljs-number">1</span>    <span class="hljs-comment"># width of waveguide</span>
</code></pre>

<p>In order to define the waveguide positions, we will have to use arithmetic to define the horizontal and vertical waveguide centers as:</p>
<pre><code class="py hljs python">wvg_xcen =  <span class="hljs-number">0.5</span>*(sx-w-<span class="hljs-number">2</span>*pad)  <span class="hljs-comment"># x center of horiz. wvg</span>
wvg_ycen = -<span class="hljs-number">0.5</span>*(sy-w-<span class="hljs-number">2</span>*pad)  <span class="hljs-comment"># y center of vert. wvg</span>
</code></pre>

<p>We proceed to define the geometry. We have to do two simulations with different geometries: the bend, and also a straight waveguide for normalization. We will first set up the straight waveguide.</p>
<pre><code class="py hljs python">geometry = [mp.Block(size=mp.Vector3(mp.inf,w,mp.inf),
                     center=mp.Vector3(<span class="hljs-number">0</span>,wvg_ycen,<span class="hljs-number">0</span>),
                     material=mp.Medium(epsilon=<span class="hljs-number">12</span>))]
</code></pre>

<p>The source is a <code>GaussianSource</code> instead of a <code>ContinuousSrc</code>, parameterized by a center frequency and a frequency width (the width of the Gaussian spectrum).</p>
<pre><code class="py hljs python">fcen = <span class="hljs-number">0.15</span>  <span class="hljs-comment"># pulse center frequency</span>
df = <span class="hljs-number">0.1</span>     <span class="hljs-comment"># pulse width (in frequency)</span>
sources = [mp.Source(mp.GaussianSource(fcen,fwidth=df),
                     component=mp.Ez,
                     center=mp.Vector3(-<span class="hljs-number">0.5</span>*sx+dpml,wvg_ycen,<span class="hljs-number">0</span>),
                     size=mp.Vector3(<span class="hljs-number">0</span>,w,<span class="hljs-number">0</span>))]
</code></pre>

<p>Notice how we're using our parameters like <code>wvg_ycen</code> and <code>w</code>: if we change the dimensions, everything will shift automatically.</p>
<p>Finally, we have to specify where we want Meep to compute the flux spectra, and at what frequencies. This must be done <em>after</em> specifying the <code>Simulation</code> object which contains the geometry, sources, resolution, etcetera, because all of the field parameters are initialized when flux planes are created. As described in <a href="https://meep.readthedocs.io/en/latest/Introduction/#transmittancereflectance-spectra">Introduction</a>, the flux is the integral of the Poynting vector over the specified <a href="https://meep.readthedocs.io/en/latest/Python_User_Interface/#fluxregion"><code>FluxRegion</code></a>. It only integrates one component of the Poynting vector and the <code>direction</code> property specifies which component. In this example, since the <code>FluxRegion</code> is a line, the <code>direction</code> is its normal by default which therefore does not need to be explicitly defined.</p>
<pre><code class="py hljs python">sim = mp.Simulation(cell_size=cell,
                    boundary_layers=pml_layers,
                    geometry=geometry,
                    sources=sources,
                    resolution=resolution)

nfreq = <span class="hljs-number">100</span>  <span class="hljs-comment"># number of frequencies at which to compute flux</span>

<span class="hljs-comment"># reflected flux</span>
refl_fr = mp.FluxRegion(center=mp.Vector3(-<span class="hljs-number">0.5</span>*sx+dpml+<span class="hljs-number">0.5</span>,wvg_ycen,<span class="hljs-number">0</span>), size=mp.Vector3(<span class="hljs-number">0</span>,<span class="hljs-number">2</span>*w,<span class="hljs-number">0</span>))                            
refl = sim.add_flux(fcen, df, nfreq, refl_fr)

<span class="hljs-comment"># transmitted flux</span>
tran_fr = mp.FluxRegion(center=mp.Vector3(<span class="hljs-number">0.5</span>*sx-dpml,wvg_ycen,<span class="hljs-number">0</span>), size=mp.Vector3(<span class="hljs-number">0</span>,<span class="hljs-number">2</span>*w,<span class="hljs-number">0</span>))
tran = sim.add_flux(fcen, df, nfreq, tran_fr)
</code></pre>

<p>We compute the fluxes through a line segment twice the width of the waveguide, located at the beginning or end of the waveguide. Note that the flux lines are separated by length <code>dpml</code> from the boundary of the cell, so that they do not lie within the absorbing PML regions. Again, there are two cases: the transmitted flux is either computed at the right or the bottom of the cell, depending on whether the waveguide is straight or bent.</p>
<p>The fluxes will be computed for <code>nfreq=100</code> frequencies centered on <code>fcen</code>, from <code>fcen-df/2</code> to <code>fcen+df/2</code>. That is, we only compute fluxes for frequencies within our pulse bandwidth. This is important because, far outside the pulse bandwidth, the spectral power is so low that numerical errors make the computed fluxes useless.</p>
<p>As described in <a href="https://meep.readthedocs.io/en/latest/Introduction/#transmittancereflectance-spectra">Introduction</a>, computing the reflection spectra requires some care because we need to separate the incident and reflected fields. We do this by first saving the Fourier-transformed fields from the normalization run. And then, before we start the second run, we load these fields, <em>negated</em>. The latter subtracts the Fourier-transformed incident fields from the Fourier transforms of the scattered fields. Logically, we might subtract these after the run, but it turns out to be more convenient to subtract the incident fields first and then accumulate the Fourier transform. All of this is accomplished with two commands which use the raw simulation data: <code>get_flux_data</code> and <code>load_minus_flux_data</code>. We run the first simulation as follows:</p>
<pre><code class="py hljs python">pt = mp.Vector3(<span class="hljs-number">0.5</span>*sx-dpml-<span class="hljs-number">0.5</span>,wvg_ycen)

sim.run(until_after_sources=mp.stop_when_fields_decayed(<span class="hljs-number">50</span>,mp.Ez,pt,<span class="hljs-number">1e-3</span>))

<span class="hljs-comment"># for normalization run, save flux fields data for reflection plane</span>
straight_refl_data = sim.get_flux_data(refl)
</code></pre>

<p>We need to keep running after the source has turned off because we must give the pulse time to propagate completely across the cell. Moreover, the time required is a bit tricky to predict when you have complex structures, because there might be resonant phenomena that allow the source to bounce around for a long time. Therefore, it is convenient to specify the run time in a different way: instead of using a fixed time, we require that |E<sub>z</sub>|<sup>2</sup> at the end of the waveguide must have decayed by a given amount (1/1000) from its peak value.</p>
<p>The <code>stop_when_fields_decayed</code> routine takes four arguments: <code>dT</code>, <code>component</code>, <code>pt</code>, and <code>decay_by</code>. What it does is, after the sources have turned off, it keeps running for an additional <code>dT</code> time units every time the given |component|<sup>2</sup> at the given point has not decayed by at least <code>decay_by</code> from its peak value for all times within the previous <code>dT</code>. In this case, <code>dT=50</code>, the component is E<sub>z</sub>, the point is at the center of the flux plane at the end of the waveguide, and <code>decay_by=0.001</code>. So, it keeps running for an additional 50 time units until the square amplitude has decayed by 1/1000 from its peak. This should be sufficient to ensure that the Fourier transforms have converged.</p>
<p>Finally, we save the incident flux using <code>get_fluxes</code> which will be used later to compute the reflectance and the transmittance:</p>
<pre><code class="py hljs python"><span class="hljs-comment"># save incident power for transmission plane</span>
straight_tran_flux = mp.get_fluxes(tran)
</code></pre>

<p>We need to run the second simulation which involves the waveguide bend. We reset the structure and fields using <code>reset_meep()</code> and redefine the <code>geometry</code>, <code>Simulation</code>, and flux objects. At the end of the simulation, we save the reflected and transmitted fluxes.</p>
<pre><code class="py hljs python">sim.reset_meep()

geometry = [mp.Block(mp.Vector3(sx-pad,w,mp.inf), center=mp.Vector3(-<span class="hljs-number">0.5</span>*pad,wvg_ycen), material=mp.Medium(epsilon=<span class="hljs-number">12</span>)),
            mp.Block(mp.Vector3(w,sy-pad,mp.inf), center=mp.Vector3(wvg_xcen,<span class="hljs-number">0.5</span>*pad), material=mp.Medium(epsilon=<span class="hljs-number">12</span>))]

sim = mp.Simulation(cell_size=cell,
                    boundary_layers=pml_layers,
                    geometry=geometry,
                    sources=sources,
                    resolution=resolution)

<span class="hljs-comment"># reflected flux</span>
refl = sim.add_flux(fcen, df, nfreq, refl_fr)

tran_fr = mp.FluxRegion(center=mp.Vector3(wvg_xcen,<span class="hljs-number">0.5</span>*sy-dpml-<span class="hljs-number">0.5</span>,<span class="hljs-number">0</span>), size=mp.Vector3(<span class="hljs-number">2</span>*w,<span class="hljs-number">0</span>,<span class="hljs-number">0</span>))
tran = sim.add_flux(fcen, df, nfreq, tran_fr)

<span class="hljs-comment"># for normal run, load negated fields to subtract incident from refl. fields</span>
sim.load_minus_flux_data(refl, straight_refl_data)

pt = mp.Vector3(wvg_xcen,<span class="hljs-number">0.5</span>*sy-dpml-<span class="hljs-number">0.5</span>)

sim.run(until_after_sources=mp.stop_when_fields_decayed(<span class="hljs-number">50</span>, mp.Ez, pt, <span class="hljs-number">1e-3</span>))

bend_refl_flux = mp.get_fluxes(refl)
bend_tran_flux = mp.get_fluxes(tran)

flux_freqs = mp.get_flux_freqs(refl)
</code></pre>

<p>With the flux data, we are ready to compute and plot the reflectance and transmittance. The reflectance is the reflected flux divided by the incident flux. We also have to multiply by -1 because all fluxes in Meep are computed in the positive-coordinate direction by default, and we want the flux in the <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-18-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-94" style="width: 1.605em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.338em; height: 0px; font-size: 117%;"><span style="position: absolute; clip: rect(1.498em, 1001.28em, 2.513em, -999.997em); top: -2.241em; left: 0em;"><span class="mrow" id="MathJax-Span-95"><span class="mo" id="MathJax-Span-96" style="font-family: MathJax_Main;">−</span><span class="mi" id="MathJax-Span-97" style="font-family: MathJax_Math-italic;">x</span></span><span style="display: inline-block; width: 0px; height: 2.246em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.184em; border-left: 0px solid; width: 0px; height: 0.878em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mo>−</mo><mi>x</mi></math></span></span><script type="math/tex" id="MathJax-Element-18">-x</script> direction. The transmittance is the transmitted flux divided by the incident flux. Finally, the scattered loss is simply <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-19-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mi&gt;s&lt;/mi&gt;&lt;mi&gt;m&lt;/mi&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-98" style="width: 16.776em; display: inline-block;"><span style="display: inline-block; position: relative; width: 14.319em; height: 0px; font-size: 117%;"><span style="position: absolute; clip: rect(1.392em, 1014.26em, 2.62em, -999.997em); top: -2.241em; left: 0em;"><span class="mrow" id="MathJax-Span-99"><span class="mn" id="MathJax-Span-100" style="font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-101" style="font-family: MathJax_Main; padding-left: 0.216em;">−</span><span class="mi" id="MathJax-Span-102" style="font-family: MathJax_Math-italic; padding-left: 0.216em;">t</span><span class="mi" id="MathJax-Span-103" style="font-family: MathJax_Math-italic;">r</span><span class="mi" id="MathJax-Span-104" style="font-family: MathJax_Math-italic;">a</span><span class="mi" id="MathJax-Span-105" style="font-family: MathJax_Math-italic;">n</span><span class="mi" id="MathJax-Span-106" style="font-family: MathJax_Math-italic;">s</span><span class="mi" id="MathJax-Span-107" style="font-family: MathJax_Math-italic;">m</span><span class="mi" id="MathJax-Span-108" style="font-family: MathJax_Math-italic;">i</span><span class="mi" id="MathJax-Span-109" style="font-family: MathJax_Math-italic;">t</span><span class="mi" id="MathJax-Span-110" style="font-family: MathJax_Math-italic;">t</span><span class="mi" id="MathJax-Span-111" style="font-family: MathJax_Math-italic;">a</span><span class="mi" id="MathJax-Span-112" style="font-family: MathJax_Math-italic;">n</span><span class="mi" id="MathJax-Span-113" style="font-family: MathJax_Math-italic;">c</span><span class="mi" id="MathJax-Span-114" style="font-family: MathJax_Math-italic;">e</span><span class="mo" id="MathJax-Span-115" style="font-family: MathJax_Main; padding-left: 0.216em;">−</span><span class="mi" id="MathJax-Span-116" style="font-family: MathJax_Math-italic; padding-left: 0.216em;">r</span><span class="mi" id="MathJax-Span-117" style="font-family: MathJax_Math-italic;">e</span><span class="mi" id="MathJax-Span-118" style="font-family: MathJax_Math-italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.056em;"></span></span><span class="mi" id="MathJax-Span-119" style="font-family: MathJax_Math-italic;">l</span><span class="mi" id="MathJax-Span-120" style="font-family: MathJax_Math-italic;">e</span><span class="mi" id="MathJax-Span-121" style="font-family: MathJax_Math-italic;">c</span><span class="mi" id="MathJax-Span-122" style="font-family: MathJax_Math-italic;">t</span><span class="mi" id="MathJax-Span-123" style="font-family: MathJax_Math-italic;">a</span><span class="mi" id="MathJax-Span-124" style="font-family: MathJax_Math-italic;">n</span><span class="mi" id="MathJax-Span-125" style="font-family: MathJax_Math-italic;">c</span><span class="mi" id="MathJax-Span-126" style="font-family: MathJax_Math-italic;">e</span></span><span style="display: inline-block; width: 0px; height: 2.246em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.191em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mn>1</mn><mo>−</mo><mi>t</mi><mi>r</mi><mi>a</mi><mi>n</mi><mi>s</mi><mi>m</mi><mi>i</mi><mi>t</mi><mi>t</mi><mi>a</mi><mi>n</mi><mi>c</mi><mi>e</mi><mo>−</mo><mi>r</mi><mi>e</mi><mi>f</mi><mi>l</mi><mi>e</mi><mi>c</mi><mi>t</mi><mi>a</mi><mi>n</mi><mi>c</mi><mi>e</mi></math></span></span><script type="math/tex" id="MathJax-Element-19">1-transmittance-reflectance</script>. The results are plotted in the accompanying figure.</p>
<pre><code class="py hljs python">wl = []
Rs = []
Ts = []
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(nfreq):
    wl = np.append(wl, <span class="hljs-number">1</span>/flux_freqs[i])
    Rs = np.append(Rs,-bend_refl_flux[i]/straight_tran_flux[i])
    Ts = np.append(Ts,bend_tran_flux[i]/straight_tran_flux[i])    

<span class="hljs-keyword">if</span> mp.am_master():
    plt.figure()
    plt.plot(wl,Rs,<span class="hljs-string">'bo-'</span>,label=<span class="hljs-string">'reflectance'</span>)
    plt.plot(wl,Ts,<span class="hljs-string">'ro-'</span>,label=<span class="hljs-string">'transmittance'</span>)
    plt.plot(wl,<span class="hljs-number">1</span>-Rs-Ts,<span class="hljs-string">'go-'</span>,label=<span class="hljs-string">'loss'</span>)
    plt.axis([<span class="hljs-number">5.0</span>, <span class="hljs-number">10.0</span>, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>])
    plt.xlabel(<span class="hljs-string">"wavelength (μm)"</span>)
    plt.legend(loc=<span class="hljs-string">"upper right"</span>)
    plt.show()
</code></pre>

<p></p><center><img alt="" src="./Tutorial_Basics - MEEP Documentation_files/Tut-bend-flux.png"></center><p></p>
<p>We should also check whether our data is converged. We can do this by increasing the resolution and cell size and seeing by how much the numbers change. In this case, we'll try doubling the cell size:</p>
<pre><code class="py hljs python">sx=<span class="hljs-number">32</span>
sy=<span class="hljs-number">64</span>
</code></pre>

<p>Again, we must run both simulations in order to get the normalization right. The results are included in the plot above as dotted lines — you can see that the numbers have changed slightly for transmittance and loss, probably stemming from interference between light radiated directly from the source and light propagating around the waveguide.</p>
<h2 id="angular-reflectance-spectrum-of-a-planar-interface">Angular Reflectance Spectrum of a Planar Interface</h2>
<p>We turn to a similar but slightly different example for which there exists an analytic solution via the <a href="https://en.wikipedia.org/wiki/Fresnel_equations">Fresnel equations</a>: computing the broadband reflectance spectrum of a planar air-dielectric interface for an incident planewave over a range of angles. Similar to the previous example, we will need to run two simulations: (1) an empty cell with air/vacuum (n=1) everywhere to obtain the incident flux, and (2) with the dielectric (n=3.5) interface to obtain the reflected flux. For each angle of the incident planewave, a separate simulation is necessary.</p>
<p>A 1d cell must be used since a higher-dimensional cell will introduce <a href="https://meep.readthedocs.io/en/latest/FAQ/#why-are-there-strange-peaks-in-my-reflectancetransmittance-spectrum-when-modeling-planar-or-periodic-structures">artificial modes due to band folding</a>. We will use a Gaussian source spanning visible wavelengths of 0.4 to 0.8 μm. Unlike a <a href="https://meep.readthedocs.io/en/latest/Python_User_Interface/#continuoussource">continuous-wave</a> (CW) source, a pulsed source turns off. This enables a termination condition of when there are no fields remaining in the cell (due to absorption by the PMLs) via the <a href="https://meep.readthedocs.io/en/latest/Python_User_Interface/#run-functions">run function</a> <code>stop_when_fields_decayed</code>, similar to the previous example.</p>
<p>Creating an oblique planewave source typically requires specifying two parameters: (1) for periodic structures, the Bloch-periodic wavevector <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-20-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mover&gt;&lt;mi&gt;k&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x2192;&lt;/mo&gt;&lt;/mover&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-127" style="width: 0.644em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.537em; height: 0px; font-size: 117%;"><span style="position: absolute; clip: rect(1.018em, 1000.54em, 2.353em, -999.997em); top: -2.188em; left: 0em;"><span class="mrow" id="MathJax-Span-128"><span class="texatom" id="MathJax-Span-129"><span class="mrow" id="MathJax-Span-130"><span class="munderover" id="MathJax-Span-131"><span style="display: inline-block; position: relative; width: 0.537em; height: 0px;"><span style="position: absolute; clip: rect(3.154em, 1000.48em, 4.169em, -999.997em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-132" style="font-family: MathJax_Math-italic;">k</span><span style="display: inline-block; width: 0px; height: 4.009em;"></span></span><span style="position: absolute; top: -4.324em; left: 0.056em;"><span style="height: 0em; vertical-align: 0em; width: 0.483em; display: inline-block; overflow: hidden;"></span><span class="mo" id="MathJax-Span-133" style="font-family: MathJax_Main;">⃗&nbsp;<span style="height: 0em; vertical-align: 0em; margin-left: -0.264em;"></span></span><span style="display: inline-block; overflow: hidden; height: 1px; width: 0em;"></span><span style="display: inline-block; width: 0px; height: 4.009em;"></span></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.193em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.316em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mover><mi>k</mi><mo stretchy="false">→</mo></mover></mrow></math></span></span><script type="math/tex" id="MathJax-Element-20">\vec{k}</script> via <code>k_point</code>, and (2) the source amplitude function <code>amp_func</code> for setting the <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-21-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msup&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mover&gt;&lt;mi&gt;k&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x2192;&lt;/mo&gt;&lt;/mover&gt;&lt;/mrow&gt;&lt;mo&gt;&amp;#x22C5;&lt;/mo&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mover&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x2192;&lt;/mo&gt;&lt;/mover&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;/msup&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-134" style="width: 2.033em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.712em; height: 0px; font-size: 117%;"><span style="position: absolute; clip: rect(0.911em, 1001.71em, 2.353em, -999.997em); top: -2.188em; left: 0em;"><span class="mrow" id="MathJax-Span-135"><span class="msubsup" id="MathJax-Span-136"><span style="display: inline-block; position: relative; width: 1.712em; height: 0px;"><span style="position: absolute; clip: rect(3.421em, 1000.43em, 4.169em, -999.997em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-137" style="font-family: MathJax_Math-italic;">e</span><span style="display: inline-block; width: 0px; height: 4.009em;"></span></span><span style="position: absolute; top: -4.378em; left: 0.483em;"><span class="texatom" id="MathJax-Span-138"><span class="mrow" id="MathJax-Span-139"><span class="mi" id="MathJax-Span-140" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span class="texatom" id="MathJax-Span-141"><span class="mrow" id="MathJax-Span-142"><span class="munderover" id="MathJax-Span-143"><span style="display: inline-block; position: relative; width: 0.377em; height: 0px;"><span style="position: absolute; clip: rect(3.368em, 1000.38em, 4.169em, -999.997em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-144" style="font-size: 70.7%; font-family: MathJax_Math-italic;">k</span><span style="display: inline-block; width: 0px; height: 4.009em;"></span></span><span style="position: absolute; top: -4.271em; left: 0.056em;"><span style="height: 0em; vertical-align: 0em; width: 0.323em; display: inline-block; overflow: hidden;"></span><span class="mo" id="MathJax-Span-145" style="font-size: 70.7%; font-family: MathJax_Main;">⃗&nbsp;<span style="height: 0em; vertical-align: 0em; margin-left: -0.158em;"></span></span><span style="display: inline-block; overflow: hidden; height: 1px; width: 0em;"></span><span style="display: inline-block; width: 0px; height: 4.009em;"></span></span></span></span></span></span><span class="mo" id="MathJax-Span-146" style="font-size: 70.7%; font-family: MathJax_Main;">⋅</span><span class="texatom" id="MathJax-Span-147"><span class="mrow" id="MathJax-Span-148"><span class="munderover" id="MathJax-Span-149"><span style="display: inline-block; position: relative; width: 0.377em; height: 0px;"><span style="position: absolute; clip: rect(3.528em, 1000.32em, 4.169em, -999.997em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-150" style="font-size: 70.7%; font-family: MathJax_Math-italic;">r</span><span style="display: inline-block; width: 0px; height: 4.009em;"></span></span><span style="position: absolute; top: -4.111em; left: 0.056em;"><span style="height: 0em; vertical-align: 0em; width: 0.323em; display: inline-block; overflow: hidden;"></span><span class="mo" id="MathJax-Span-151" style="font-size: 70.7%; font-family: MathJax_Main;">⃗&nbsp;<span style="height: 0em; vertical-align: 0em; margin-left: -0.158em;"></span></span><span style="display: inline-block; overflow: hidden; height: 1px; width: 0em;"></span><span style="display: inline-block; width: 0px; height: 4.009em;"></span></span></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.009em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.193em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.441em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mi>e</mi><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mrow class="MJX-TeXAtom-ORD"><mover><mi>k</mi><mo stretchy="false">→</mo></mover></mrow><mo>⋅</mo><mrow class="MJX-TeXAtom-ORD"><mover><mi>r</mi><mo stretchy="false">→</mo></mover></mrow></mrow></msup></math></span></span><script type="math/tex" id="MathJax-Element-21">e^{i\vec{k} \cdot \vec{r}}</script> spatial dependence (<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-22-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mover&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x2192;&lt;/mo&gt;&lt;/mover&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-152" style="width: 0.59em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.483em; height: 0px; font-size: 117%;"><span style="position: absolute; clip: rect(1.285em, 1000.43em, 2.353em, -999.997em); top: -2.188em; left: 0em;"><span class="mrow" id="MathJax-Span-153"><span class="texatom" id="MathJax-Span-154"><span class="mrow" id="MathJax-Span-155"><span class="munderover" id="MathJax-Span-156"><span style="display: inline-block; position: relative; width: 0.483em; height: 0px;"><span style="position: absolute; clip: rect(3.421em, 1000.43em, 4.169em, -999.997em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-157" style="font-family: MathJax_Math-italic;">r</span><span style="display: inline-block; width: 0px; height: 4.009em;"></span></span><span style="position: absolute; top: -4.057em; left: 0.056em;"><span style="height: 0em; vertical-align: 0em; width: 0.483em; display: inline-block; overflow: hidden;"></span><span class="mo" id="MathJax-Span-158" style="font-family: MathJax_Main;">⃗&nbsp;<span style="height: 0em; vertical-align: 0em; margin-left: -0.264em;"></span></span><span style="display: inline-block; overflow: hidden; height: 1px; width: 0em;"></span><span style="display: inline-block; width: 0px; height: 4.009em;"></span></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.193em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.066em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mover><mi>r</mi><mo stretchy="false">→</mo></mover></mrow></math></span></span><script type="math/tex" id="MathJax-Element-22">\vec{r}</script> is the position vector). Since we have a 1d cell and the source is at a single point, it is not necessary to specify the source amplitude (see this <a href="https://github.com/NanoComp/meep/blob/master/python/examples/pw-source.py">2d example</a> for how this is done). The magnitude of the Bloch-periodic wavevector is specified according to the dispersion relation formula for a planewave in homogeneous media with index n: <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-23-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03C9;&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mover&gt;&lt;mi&gt;k&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x2192;&lt;/mo&gt;&lt;/mover&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;/&lt;/mo&gt;&lt;/mrow&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-159" style="width: 5.345em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.543em; height: 0px; font-size: 117%;"><span style="position: absolute; clip: rect(1.071em, 1004.54em, 2.674em, -999.997em); top: -2.241em; left: 0em;"><span class="mrow" id="MathJax-Span-160"><span class="mi" id="MathJax-Span-161" style="font-family: MathJax_Math-italic;">ω</span><span class="mo" id="MathJax-Span-162" style="font-family: MathJax_Main; padding-left: 0.27em;">=</span><span class="mi" id="MathJax-Span-163" style="font-family: MathJax_Math-italic; padding-left: 0.27em;">c</span><span class="texatom" id="MathJax-Span-164"><span class="mrow" id="MathJax-Span-165"><span class="mo" id="MathJax-Span-166" style="font-family: MathJax_Main;">|</span></span></span><span class="texatom" id="MathJax-Span-167"><span class="mrow" id="MathJax-Span-168"><span class="munderover" id="MathJax-Span-169"><span style="display: inline-block; position: relative; width: 0.537em; height: 0px;"><span style="position: absolute; clip: rect(3.154em, 1000.48em, 4.169em, -999.997em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-170" style="font-family: MathJax_Math-italic;">k</span><span style="display: inline-block; width: 0px; height: 4.009em;"></span></span><span style="position: absolute; top: -4.324em; left: 0.056em;"><span style="height: 0em; vertical-align: 0em; width: 0.483em; display: inline-block; overflow: hidden;"></span><span class="mo" id="MathJax-Span-171" style="font-family: MathJax_Main;">⃗&nbsp;<span style="height: 0em; vertical-align: 0em; margin-left: -0.264em;"></span></span><span style="display: inline-block; overflow: hidden; height: 1px; width: 0em;"></span><span style="display: inline-block; width: 0px; height: 4.009em;"></span></span></span></span></span></span><span class="texatom" id="MathJax-Span-172"><span class="mrow" id="MathJax-Span-173"><span class="mo" id="MathJax-Span-174" style="font-family: MathJax_Main;">|</span></span></span><span class="texatom" id="MathJax-Span-175"><span class="mrow" id="MathJax-Span-176"><span class="mo" id="MathJax-Span-177" style="font-family: MathJax_Main;">/</span></span></span><span class="mi" id="MathJax-Span-178" style="font-family: MathJax_Math-italic;">n</span></span><span style="display: inline-block; width: 0px; height: 2.246em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.628em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>ω</mi><mo>=</mo><mi>c</mi><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mover><mi>k</mi><mo stretchy="false">→</mo></mover></mrow><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mo>/</mo></mrow><mi>n</mi></math></span></span><script type="math/tex" id="MathJax-Element-23">\omega=c|\vec{k}|/n</script>. As the source in this example is incident from air, <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-24-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mover&gt;&lt;mi&gt;k&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x2192;&lt;/mo&gt;&lt;/mover&gt;&lt;/mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-179" style="width: 1.285em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.071em; height: 0px; font-size: 117%;"><span style="position: absolute; clip: rect(1.071em, 1000.96em, 2.674em, -999.997em); top: -2.241em; left: 0em;"><span class="mrow" id="MathJax-Span-180"><span class="texatom" id="MathJax-Span-181"><span class="mrow" id="MathJax-Span-182"><span class="mo" id="MathJax-Span-183" style="font-family: MathJax_Main;">|</span></span></span><span class="texatom" id="MathJax-Span-184"><span class="mrow" id="MathJax-Span-185"><span class="munderover" id="MathJax-Span-186"><span style="display: inline-block; position: relative; width: 0.537em; height: 0px;"><span style="position: absolute; clip: rect(3.154em, 1000.48em, 4.169em, -999.997em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-187" style="font-family: MathJax_Math-italic;">k</span><span style="display: inline-block; width: 0px; height: 4.009em;"></span></span><span style="position: absolute; top: -4.324em; left: 0.056em;"><span style="height: 0em; vertical-align: 0em; width: 0.483em; display: inline-block; overflow: hidden;"></span><span class="mo" id="MathJax-Span-188" style="font-family: MathJax_Main;">⃗&nbsp;<span style="height: 0em; vertical-align: 0em; margin-left: -0.264em;"></span></span><span style="display: inline-block; overflow: hidden; height: 1px; width: 0em;"></span><span style="display: inline-block; width: 0px; height: 4.009em;"></span></span></span></span></span></span><span class="texatom" id="MathJax-Span-189"><span class="mrow" id="MathJax-Span-190"><span class="mo" id="MathJax-Span-191" style="font-family: MathJax_Main;">|</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.246em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.628em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><mrow class="MJX-TeXAtom-ORD"><mover><mi>k</mi><mo stretchy="false">→</mo></mover></mrow><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow></math></span></span><script type="math/tex" id="MathJax-Element-24">|\vec{k}|</script> is simply equal to the frequency ω (the minimum frequency of the pulse which excludes the 2π factor). Note that a fixed wavevector only applies to a single frequency. Any broadband source is therefore incident at a specified angle for only a <em>single</em> frequency. This is described in more detail in Section 4.5 ("Efficient Frequency-Angle Coverage") in <a href="https://arxiv.org/abs/1301.5366">Chapter 4</a> ("Electromagnetic Wave Source Conditions") of the book <a href="https://www.amazon.com/Advances-FDTD-Computational-Electrodynamics-Nanotechnology/dp/1608071707">Advances in FDTD Computational Electrodynamics: Photonics and Nanotechnology</a>.</p>
<p>In this example, the plane of incidence which contains <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-25-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mover&gt;&lt;mi&gt;k&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x2192;&lt;/mo&gt;&lt;/mover&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-192" style="width: 0.644em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.537em; height: 0px; font-size: 117%;"><span style="position: absolute; clip: rect(1.018em, 1000.54em, 2.353em, -999.997em); top: -2.188em; left: 0em;"><span class="mrow" id="MathJax-Span-193"><span class="texatom" id="MathJax-Span-194"><span class="mrow" id="MathJax-Span-195"><span class="munderover" id="MathJax-Span-196"><span style="display: inline-block; position: relative; width: 0.537em; height: 0px;"><span style="position: absolute; clip: rect(3.154em, 1000.48em, 4.169em, -999.997em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-197" style="font-family: MathJax_Math-italic;">k</span><span style="display: inline-block; width: 0px; height: 4.009em;"></span></span><span style="position: absolute; top: -4.324em; left: 0.056em;"><span style="height: 0em; vertical-align: 0em; width: 0.483em; display: inline-block; overflow: hidden;"></span><span class="mo" id="MathJax-Span-198" style="font-family: MathJax_Main;">⃗&nbsp;<span style="height: 0em; vertical-align: 0em; margin-left: -0.264em;"></span></span><span style="display: inline-block; overflow: hidden; height: 1px; width: 0em;"></span><span style="display: inline-block; width: 0px; height: 4.009em;"></span></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.193em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.316em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mover><mi>k</mi><mo stretchy="false">→</mo></mover></mrow></math></span></span><script type="math/tex" id="MathJax-Element-25">\vec{k}</script> and the surface normal vector is <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-26-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-199" style="width: 1.231em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.018em; height: 0px; font-size: 117%;"><span style="position: absolute; clip: rect(1.605em, 1001.02em, 2.353em, -999.997em); top: -2.188em; left: 0em;"><span class="mrow" id="MathJax-Span-200"><span class="mi" id="MathJax-Span-201" style="font-family: MathJax_Math-italic;">x</span><span class="mi" id="MathJax-Span-202" style="font-family: MathJax_Math-italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.193em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.628em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>x</mi><mi>z</mi></math></span></span><script type="math/tex" id="MathJax-Element-26">xz</script>. The source angle θ is defined in degrees in the counterclockwise (CCW) direction around the <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-27-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-203" style="width: 0.59em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.483em; height: 0px; font-size: 117%;"><span style="position: absolute; clip: rect(1.605em, 1000.48em, 2.567em, -999.997em); top: -2.188em; left: 0em;"><span class="mrow" id="MathJax-Span-204"><span class="mi" id="MathJax-Span-205" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.193em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 0.878em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>y</mi></math></span></span><script type="math/tex" id="MathJax-Element-27">y</script> axis with 0 degrees along the +<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-28-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-206" style="width: 0.59em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.483em; height: 0px; font-size: 117%;"><span style="position: absolute; clip: rect(1.605em, 1000.48em, 2.353em, -999.997em); top: -2.188em; left: 0em;"><span class="mrow" id="MathJax-Span-207"><span class="mi" id="MathJax-Span-208" style="font-family: MathJax_Math-italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.193em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.628em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>z</mi></math></span></span><script type="math/tex" id="MathJax-Element-28">z</script> axis. In Meep, a 1d cell is defined along the <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-29-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-209" style="width: 0.59em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.483em; height: 0px; font-size: 117%;"><span style="position: absolute; clip: rect(1.605em, 1000.48em, 2.353em, -999.997em); top: -2.188em; left: 0em;"><span class="mrow" id="MathJax-Span-210"><span class="mi" id="MathJax-Span-211" style="font-family: MathJax_Math-italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.193em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.628em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>z</mi></math></span></span><script type="math/tex" id="MathJax-Element-29">z</script> direction. When <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-30-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mover&gt;&lt;mi&gt;k&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x2192;&lt;/mo&gt;&lt;/mover&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-212" style="width: 0.644em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.537em; height: 0px; font-size: 117%;"><span style="position: absolute; clip: rect(1.018em, 1000.54em, 2.353em, -999.997em); top: -2.188em; left: 0em;"><span class="mrow" id="MathJax-Span-213"><span class="texatom" id="MathJax-Span-214"><span class="mrow" id="MathJax-Span-215"><span class="munderover" id="MathJax-Span-216"><span style="display: inline-block; position: relative; width: 0.537em; height: 0px;"><span style="position: absolute; clip: rect(3.154em, 1000.48em, 4.169em, -999.997em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-217" style="font-family: MathJax_Math-italic;">k</span><span style="display: inline-block; width: 0px; height: 4.009em;"></span></span><span style="position: absolute; top: -4.324em; left: 0.056em;"><span style="height: 0em; vertical-align: 0em; width: 0.483em; display: inline-block; overflow: hidden;"></span><span class="mo" id="MathJax-Span-218" style="font-family: MathJax_Main;">⃗&nbsp;<span style="height: 0em; vertical-align: 0em; margin-left: -0.264em;"></span></span><span style="display: inline-block; overflow: hidden; height: 1px; width: 0em;"></span><span style="display: inline-block; width: 0px; height: 4.009em;"></span></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.193em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.316em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mover><mi>k</mi><mo stretchy="false">→</mo></mover></mrow></math></span></span><script type="math/tex" id="MathJax-Element-30">\vec{k}</script> is not set, only the E<sub>x</sub> and H<sub>y</sub> field components are permitted. A non-zero <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-31-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mover&gt;&lt;mi&gt;k&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;&amp;#x2192;&lt;/mo&gt;&lt;/mover&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-219" style="width: 0.644em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.537em; height: 0px; font-size: 117%;"><span style="position: absolute; clip: rect(1.018em, 1000.54em, 2.353em, -999.997em); top: -2.188em; left: 0em;"><span class="mrow" id="MathJax-Span-220"><span class="texatom" id="MathJax-Span-221"><span class="mrow" id="MathJax-Span-222"><span class="munderover" id="MathJax-Span-223"><span style="display: inline-block; position: relative; width: 0.537em; height: 0px;"><span style="position: absolute; clip: rect(3.154em, 1000.48em, 4.169em, -999.997em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-224" style="font-family: MathJax_Math-italic;">k</span><span style="display: inline-block; width: 0px; height: 4.009em;"></span></span><span style="position: absolute; top: -4.324em; left: 0.056em;"><span style="height: 0em; vertical-align: 0em; width: 0.483em; display: inline-block; overflow: hidden;"></span><span class="mo" id="MathJax-Span-225" style="font-family: MathJax_Main;">⃗&nbsp;<span style="height: 0em; vertical-align: 0em; margin-left: -0.264em;"></span></span><span style="display: inline-block; overflow: hidden; height: 1px; width: 0em;"></span><span style="display: inline-block; width: 0px; height: 4.009em;"></span></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.193em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.316em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mover><mi>k</mi><mo stretchy="false">→</mo></mover></mrow></math></span></span><script type="math/tex" id="MathJax-Element-31">\vec{k}</script> results in a 3d simulation where all field components are allowed and are complex (the fields are real, by default). A current source with E<sub>x</sub> polarization lies in the plane of incidence and corresponds to the convention of <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-32-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi class=&quot;MJX-tex-caligraphic&quot; mathvariant=&quot;script&quot;&gt;P&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-226" style="width: 0.911em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.751em; height: 0px; font-size: 117%;"><span style="position: absolute; clip: rect(1.338em, 1000.75em, 2.407em, -999.997em); top: -2.188em; left: 0em;"><span class="mrow" id="MathJax-Span-227"><span class="texatom" id="MathJax-Span-228"><span class="mrow" id="MathJax-Span-229"><span class="mi" id="MathJax-Span-230" style="font-family: MathJax_Caligraphic;">P<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.056em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.193em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.122em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi class="MJX-tex-caligraphic" mathvariant="script">P</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-32">\mathcal{P}</script>-polarization. In order to model the <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-33-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi class=&quot;MJX-tex-caligraphic&quot; mathvariant=&quot;script&quot;&gt;S&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-231" style="width: 0.751em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.644em; height: 0px; font-size: 117%;"><span style="position: absolute; clip: rect(1.338em, 1000.64em, 2.353em, -999.997em); top: -2.188em; left: 0em;"><span class="mrow" id="MathJax-Span-232"><span class="texatom" id="MathJax-Span-233"><span class="mrow" id="MathJax-Span-234"><span class="mi" id="MathJax-Span-235" style="font-family: MathJax_Caligraphic;">S<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.056em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.193em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi class="MJX-tex-caligraphic" mathvariant="script">S</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-33">\mathcal{S}</script>-polarization, we must use an E<sub>y</sub> source. This example involves just the <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-34-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi class=&quot;MJX-tex-caligraphic&quot; mathvariant=&quot;script&quot;&gt;P&lt;/mi&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-236" style="width: 0.911em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.751em; height: 0px; font-size: 117%;"><span style="position: absolute; clip: rect(1.338em, 1000.75em, 2.407em, -999.997em); top: -2.188em; left: 0em;"><span class="mrow" id="MathJax-Span-237"><span class="texatom" id="MathJax-Span-238"><span class="mrow" id="MathJax-Span-239"><span class="mi" id="MathJax-Span-240" style="font-family: MathJax_Caligraphic;">P<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.056em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.193em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.122em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mi class="MJX-tex-caligraphic" mathvariant="script">P</mi></mrow></math></span></span><script type="math/tex" id="MathJax-Element-34">\mathcal{P}</script>-polarization.</p>
<p>The simulation script is <a href="https://github.com/NanoComp/meep/blob/master/python/examples/refl-angular.py">examples/refl-angular.py</a>. The notebook is <a href="https://nbviewer.jupyter.org/github/NanoComp/meep/blob/master/python/examples/refl-angular.ipynb">examples/refl-angular.ipynb</a>.</p>
<pre><code class="py hljs python"><span class="hljs-keyword">import</span> meep <span class="hljs-keyword">as</span> mp
<span class="hljs-keyword">import</span> argparse
<span class="hljs-keyword">import</span> math

<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">main</span><span class="hljs-params">(args)</span>:</span>

    resolution = args.res

    dpml = <span class="hljs-number">1.0</span>              <span class="hljs-comment"># PML thickness</span>
    sz = <span class="hljs-number">10</span>                 <span class="hljs-comment"># size of cell (without PMLs)</span>
    sz = <span class="hljs-number">10</span> + <span class="hljs-number">2</span>*dpml
    cell_size = mp.Vector3(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,sz)
    pml_layers = [mp.PML(dpml)]

    wvl_min = <span class="hljs-number">0.4</span>           <span class="hljs-comment"># min wavelength</span>
    wvl_max = <span class="hljs-number">0.8</span>           <span class="hljs-comment"># max wavelength</span>
    fmin = <span class="hljs-number">1</span>/wvl_max        <span class="hljs-comment"># min frequency</span>
    fmax = <span class="hljs-number">1</span>/wvl_min        <span class="hljs-comment"># max frequency</span>
    fcen = <span class="hljs-number">0.5</span>*(fmin+fmax)  <span class="hljs-comment"># center frequency</span>
    df = fmax-fmin          <span class="hljs-comment"># frequency width</span>
    nfreq = <span class="hljs-number">50</span>              <span class="hljs-comment"># number of frequency bins</span>

    <span class="hljs-comment"># rotation angle (in degrees) of source: CCW around Y axis, 0 degrees along +Z axis</span>
    theta_r = math.radians(args.theta)

    <span class="hljs-comment"># plane of incidence is xz</span>
    k = mp.Vector3(math.sin(theta_r),<span class="hljs-number">0</span>,math.cos(theta_r)).scale(fmin)

    <span class="hljs-comment"># if normal incidence, force number of dimensions to be 1</span>
    <span class="hljs-keyword">if</span> theta_r == <span class="hljs-number">0</span>:
        dimensions = <span class="hljs-number">1</span>
    <span class="hljs-keyword">else</span>:
        dimensions = <span class="hljs-number">3</span>

    sources = [mp.Source(mp.GaussianSource(fcen,fwidth=df), component=mp.Ex, center=mp.Vector3(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,-<span class="hljs-number">0.5</span>*sz+dpml))]

    sim = mp.Simulation(cell_size=cell_size,
                        boundary_layers=pml_layers,
                        sources=sources,
                        k_point=k,
                        dimensions=dimensions,
                        resolution=resolution)

    refl_fr = mp.FluxRegion(center=mp.Vector3(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,-<span class="hljs-number">0.25</span>*sz))
    refl = sim.add_flux(fcen, df, nfreq, refl_fr)

    sim.run(until_after_sources=mp.stop_when_fields_decayed(<span class="hljs-number">50</span>, mp.Ex, mp.Vector3(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,-<span class="hljs-number">0.5</span>*sz+dpml), <span class="hljs-number">1e-9</span>))

    empty_flux = mp.get_fluxes(refl)
    empty_data = sim.get_flux_data(refl)
    sim.reset_meep()

    <span class="hljs-comment"># add a block with n=3.5 for the air-dielectric interface</span>
    geometry = [mp.Block(mp.Vector3(mp.inf,mp.inf,<span class="hljs-number">0.5</span>*sz), center=mp.Vector3(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,<span class="hljs-number">0.25</span>*sz), material=mp.Medium(index=<span class="hljs-number">3.5</span>))]

    sim = mp.Simulation(cell_size=cell_size,
                        geometry=geometry,
                        boundary_layers=pml_layers,
                        sources=sources,
                        k_point=k,
                        dimensions=dimensions,
                        resolution=resolution)

    refl = sim.add_flux(fcen, df, nfreq, refl_fr)
    sim.load_minus_flux_data(refl, empty_data)

    sim.run(until_after_sources=mp.stop_when_fields_decayed(<span class="hljs-number">50</span>, mp.Ex, mp.Vector3(<span class="hljs-number">0</span>,<span class="hljs-number">0</span>,-<span class="hljs-number">0.5</span>*sz+dpml), <span class="hljs-number">1e-9</span>))

    refl_flux = mp.get_fluxes(refl)
    freqs = mp.get_flux_freqs(refl)

    <span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> range(nfreq):
        print(<span class="hljs-string">"refl:, {}, {}, {}, {}"</span>.format(k.x,<span class="hljs-number">1</span>/freqs[i],math.degrees(math.asin(k.x/freqs[i])),-refl_flux[i]/empty_flux[i]))

<span class="hljs-keyword">if</span> __name__ == <span class="hljs-string">'__main__'</span>:
    parser = argparse.ArgumentParser()
    parser.add_argument(<span class="hljs-string">'-res'</span>, type=int, default=<span class="hljs-number">200</span>, help=<span class="hljs-string">'resolution (default: 200 pixels/um)'</span>)
    parser.add_argument(<span class="hljs-string">'-theta'</span>, type=float, default=<span class="hljs-number">0</span>, help=<span class="hljs-string">'angle of incident planewave (default: 0 degrees)'</span>)
    args = parser.parse_args()
    main(args)
</code></pre>

<p>The simulation script above computes and prints to standard output the reflectance at each frequency. Also included in the output is the wavevector component <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-35-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;k&lt;/mi&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-241" style="width: 1.231em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.018em; height: 0px; font-size: 117%;"><span style="position: absolute; clip: rect(1.338em, 1001.02em, 2.513em, -999.997em); top: -2.188em; left: 0em;"><span class="mrow" id="MathJax-Span-242"><span class="msubsup" id="MathJax-Span-243"><span style="display: inline-block; position: relative; width: 1.018em; height: 0px;"><span style="position: absolute; clip: rect(3.154em, 1000.48em, 4.169em, -999.997em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-244" style="font-family: MathJax_Math-italic;">k</span><span style="display: inline-block; width: 0px; height: 4.009em;"></span></span><span style="position: absolute; top: -3.843em; left: 0.537em;"><span class="mi" id="MathJax-Span-245" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.009em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.193em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>k</mi><mi>x</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-35">k_x</script> and the corresponding angle for the (<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-36-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;k&lt;/mi&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-246" style="width: 1.231em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.018em; height: 0px; font-size: 117%;"><span style="position: absolute; clip: rect(1.338em, 1001.02em, 2.513em, -999.997em); top: -2.188em; left: 0em;"><span class="mrow" id="MathJax-Span-247"><span class="msubsup" id="MathJax-Span-248"><span style="display: inline-block; position: relative; width: 1.018em; height: 0px;"><span style="position: absolute; clip: rect(3.154em, 1000.48em, 4.169em, -999.997em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-249" style="font-family: MathJax_Math-italic;">k</span><span style="display: inline-block; width: 0px; height: 4.009em;"></span></span><span style="position: absolute; top: -3.843em; left: 0.537em;"><span class="mi" id="MathJax-Span-250" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.009em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.193em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>k</mi><mi>x</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-36">k_x</script>, ω) pair. For those frequencies not equal to the minimum frequency of the source, this is <em>not</em> the same as the specified angle of the incident planewave, but rather sin<sup>-1</sup>(k<sub>x</sub>/ω).</p>
<p>Note that there are two argument parameters which can be passed to the script at runtime: the resolution of the grid and the angle of the incident planewave. The following Bash shell script runs the simulation for the wavelength range of 0<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-37-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msup&gt;&lt;mi&gt;&lt;/mi&gt;&lt;mo&gt;&amp;#x2218;&lt;/mo&gt;&lt;/msup&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-251" style="width: 0.537em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.43em; height: 0px; font-size: 117%;"><span style="position: absolute; clip: rect(1.338em, 1000.43em, 2.353em, -999.997em); top: -2.188em; left: 0em;"><span class="mrow" id="MathJax-Span-252"><span class="msubsup" id="MathJax-Span-253"><span style="display: inline-block; position: relative; width: 0.43em; height: 0px;"><span style="position: absolute; clip: rect(3.849em, 1000em, 4.169em, -999.997em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-254"></span><span style="display: inline-block; width: 0px; height: 4.009em;"></span></span><span style="position: absolute; top: -4.378em; left: 0em;"><span class="mo" id="MathJax-Span-255" style="font-size: 70.7%; font-family: MathJax_Main;">∘</span><span style="display: inline-block; width: 0px; height: 4.009em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.193em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mi></mi><mo>∘</mo></msup></math></span></span><script type="math/tex" id="MathJax-Element-37">^\circ</script> to 80<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-38-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msup&gt;&lt;mi&gt;&lt;/mi&gt;&lt;mo&gt;&amp;#x2218;&lt;/mo&gt;&lt;/msup&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-256" style="width: 0.537em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.43em; height: 0px; font-size: 117%;"><span style="position: absolute; clip: rect(1.338em, 1000.43em, 2.353em, -999.997em); top: -2.188em; left: 0em;"><span class="mrow" id="MathJax-Span-257"><span class="msubsup" id="MathJax-Span-258"><span style="display: inline-block; position: relative; width: 0.43em; height: 0px;"><span style="position: absolute; clip: rect(3.849em, 1000em, 4.169em, -999.997em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-259"></span><span style="display: inline-block; width: 0px; height: 4.009em;"></span></span><span style="position: absolute; top: -4.378em; left: 0em;"><span class="mo" id="MathJax-Span-260" style="font-size: 70.7%; font-family: MathJax_Main;">∘</span><span style="display: inline-block; width: 0px; height: 4.009em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.193em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mi></mi><mo>∘</mo></msup></math></span></span><script type="math/tex" id="MathJax-Element-38">^\circ</script> in increments of 5<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-39-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msup&gt;&lt;mi&gt;&lt;/mi&gt;&lt;mo&gt;&amp;#x2218;&lt;/mo&gt;&lt;/msup&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-261" style="width: 0.537em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.43em; height: 0px; font-size: 117%;"><span style="position: absolute; clip: rect(1.338em, 1000.43em, 2.353em, -999.997em); top: -2.188em; left: 0em;"><span class="mrow" id="MathJax-Span-262"><span class="msubsup" id="MathJax-Span-263"><span style="display: inline-block; position: relative; width: 0.43em; height: 0px;"><span style="position: absolute; clip: rect(3.849em, 1000em, 4.169em, -999.997em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-264"></span><span style="display: inline-block; width: 0px; height: 4.009em;"></span></span><span style="position: absolute; top: -4.378em; left: 0em;"><span class="mo" id="MathJax-Span-265" style="font-size: 70.7%; font-family: MathJax_Main;">∘</span><span style="display: inline-block; width: 0px; height: 4.009em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.193em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mi></mi><mo>∘</mo></msup></math></span></span><script type="math/tex" id="MathJax-Element-39">^\circ</script>. For each run, the script pipes the output to one file and extracts the reflectance data to a different file.</p>
<pre><code class="sh hljs bash"><span class="hljs-shebang">#!/bin/bash
</span>
<span class="hljs-keyword">for</span> i <span class="hljs-keyword">in</span> `seq <span class="hljs-number">0</span> <span class="hljs-number">5</span> <span class="hljs-number">80</span>`; <span class="hljs-keyword">do</span>
    python -u refl-angular.py -theta <span class="hljs-variable">$i</span> |tee <span class="hljs-operator">-a</span> flux_t<span class="hljs-variable">${i}</span>.out;
    grep refl: flux_t<span class="hljs-variable">${i}</span>.out |cut <span class="hljs-operator">-d</span> , <span class="hljs-operator">-f</span>2- &gt; flux_t<span class="hljs-variable">${i}</span>.dat;
<span class="hljs-keyword">done</span>
</code></pre>

<p>Two-dimensional plots of the angular reflectance spectrum based on the simulated data and the analytic <a href="https://en.wikipedia.org/wiki/Fresnel_equations">Fresnel equations</a> are generated using the Python script below. The plots are shown in the accompanying figure with four insets. The top left inset shows the simulated and analytic reflectance spectra at a wavelength of 0.6 μm. The top right inset shows the simulated reflectance spectrum as a function of the source wavelength λ and Bloch-periodic wavevector <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-40-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;k&lt;/mi&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-266" style="width: 1.231em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.018em; height: 0px; font-size: 117%;"><span style="position: absolute; clip: rect(1.338em, 1001.02em, 2.513em, -999.997em); top: -2.188em; left: 0em;"><span class="mrow" id="MathJax-Span-267"><span class="msubsup" id="MathJax-Span-268"><span style="display: inline-block; position: relative; width: 1.018em; height: 0px;"><span style="position: absolute; clip: rect(3.154em, 1000.48em, 4.169em, -999.997em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-269" style="font-family: MathJax_Math-italic;">k</span><span style="display: inline-block; width: 0px; height: 4.009em;"></span></span><span style="position: absolute; top: -3.843em; left: 0.537em;"><span class="mi" id="MathJax-Span-270" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.009em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.193em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>k</mi><mi>x</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-40">k_x</script>: <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-41-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;R&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;&amp;#x03BB;&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;k&lt;/mi&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-271" style="width: 4.223em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.582em; height: 0px; font-size: 117%;"><span style="position: absolute; clip: rect(1.338em, 1003.48em, 2.674em, -999.997em); top: -2.241em; left: 0em;"><span class="mrow" id="MathJax-Span-272"><span class="mi" id="MathJax-Span-273" style="font-family: MathJax_Math-italic;">R</span><span class="mo" id="MathJax-Span-274" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-275" style="font-family: MathJax_Math-italic;">λ</span><span class="mo" id="MathJax-Span-276" style="font-family: MathJax_Main;">,</span><span class="msubsup" id="MathJax-Span-277" style="padding-left: 0.163em;"><span style="display: inline-block; position: relative; width: 1.018em; height: 0px;"><span style="position: absolute; clip: rect(3.154em, 1000.48em, 4.169em, -999.997em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-278" style="font-family: MathJax_Math-italic;">k</span><span style="display: inline-block; width: 0px; height: 4.009em;"></span></span><span style="position: absolute; top: -3.843em; left: 0.537em;"><span class="mi" id="MathJax-Span-279" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.009em;"></span></span></span></span><span class="mo" id="MathJax-Span-280" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.246em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.316em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>R</mi><mo stretchy="false">(</mo><mi>λ</mi><mo>,</mo><msub><mi>k</mi><mi>x</mi></msub><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-41">R(\lambda, k_x)</script>. The lower left inset is a transformation of <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-42-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;R&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;&amp;#x03BB;&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;msub&gt;&lt;mi&gt;k&lt;/mi&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/msub&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-281" style="width: 4.223em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.582em; height: 0px; font-size: 117%;"><span style="position: absolute; clip: rect(1.338em, 1003.48em, 2.674em, -999.997em); top: -2.241em; left: 0em;"><span class="mrow" id="MathJax-Span-282"><span class="mi" id="MathJax-Span-283" style="font-family: MathJax_Math-italic;">R</span><span class="mo" id="MathJax-Span-284" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-285" style="font-family: MathJax_Math-italic;">λ</span><span class="mo" id="MathJax-Span-286" style="font-family: MathJax_Main;">,</span><span class="msubsup" id="MathJax-Span-287" style="padding-left: 0.163em;"><span style="display: inline-block; position: relative; width: 1.018em; height: 0px;"><span style="position: absolute; clip: rect(3.154em, 1000.48em, 4.169em, -999.997em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-288" style="font-family: MathJax_Math-italic;">k</span><span style="display: inline-block; width: 0px; height: 4.009em;"></span></span><span style="position: absolute; top: -3.843em; left: 0.537em;"><span class="mi" id="MathJax-Span-289" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.009em;"></span></span></span></span><span class="mo" id="MathJax-Span-290" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.246em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.316em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>R</mi><mo stretchy="false">(</mo><mi>λ</mi><mo>,</mo><msub><mi>k</mi><mi>x</mi></msub><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-42">R(\lambda, k_x)</script> into <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-43-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;R&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;&amp;#x03BB;&lt;/mi&gt;&lt;mo&gt;,&lt;/mo&gt;&lt;mi&gt;&amp;#x03B8;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-291" style="width: 3.582em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.048em; height: 0px; font-size: 117%;"><span style="position: absolute; clip: rect(1.338em, 1002.94em, 2.674em, -999.997em); top: -2.241em; left: 0em;"><span class="mrow" id="MathJax-Span-292"><span class="mi" id="MathJax-Span-293" style="font-family: MathJax_Math-italic;">R</span><span class="mo" id="MathJax-Span-294" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-295" style="font-family: MathJax_Math-italic;">λ</span><span class="mo" id="MathJax-Span-296" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-297" style="font-family: MathJax_Math-italic; padding-left: 0.163em;">θ</span><span class="mo" id="MathJax-Span-298" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.246em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.316em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>R</mi><mo stretchy="false">(</mo><mi>λ</mi><mo>,</mo><mi>θ</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-43">R(\lambda, \theta)</script>. Note how the range of angles depends on the wavelength. For a particular angle, the reflectance is a constant for all wavelengths due to the dispersionless dielectric. The lower right inset is the analytic reflectance spectrum computed using the Fresnel equations. There is agreement between the simulated and analytic results. The <a href="https://en.wikipedia.org/wiki/Brewster%27s_angle">Brewster's angle</a>, where the transmittance is 1 and the reflectance is 0, is tan<sup>-1</sup>(3.5/1)=74.1°. This is also verified by the simulated results.</p>
<p>In order to generate results for the missing portion of the reflectance spectrum (i.e., the white region), we will need to rerun the simulations for different wavelength spectra.</p>
<pre><code class="py hljs python"><span class="hljs-keyword">import</span> matplotlib.pyplot <span class="hljs-keyword">as</span> plt
<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np
<span class="hljs-keyword">import</span> numpy.matlib
<span class="hljs-keyword">import</span> math

theta_in = np.arange(<span class="hljs-number">0</span>,<span class="hljs-number">85</span>,<span class="hljs-number">5</span>)
kxs = np.empty((<span class="hljs-number">50</span>,theta_in.size))
thetas = np.empty((<span class="hljs-number">50</span>,theta_in.size))
Rmeep = np.empty((<span class="hljs-number">50</span>,theta_in.size))

<span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> range(theta_in.size):
  f = np.genfromtxt(<span class="hljs-string">"flux_t{}.dat"</span>.format(theta_in[j]), delimiter=<span class="hljs-string">","</span>)
  kxs[:,j] = f[:,<span class="hljs-number">0</span>]
  thetas[:,j] = f[:,<span class="hljs-number">2</span>]
  Rmeep[:,j] = f[:,<span class="hljs-number">3</span>]

wvl = f[:,<span class="hljs-number">1</span>]
<span class="hljs-comment"># create a 2d matrix for the wavelength by repeating the column vector for each angle</span>
wvls = np.matlib.repmat(np.reshape(wvl, (wvl.size,<span class="hljs-number">1</span>)),<span class="hljs-number">1</span>,theta_in.size)

plt.figure()
plt.pcolormesh(kxs, wvls, Rmeep, cmap=<span class="hljs-string">'hot'</span>, shading=<span class="hljs-string">'gouraud'</span>, vmin=<span class="hljs-number">0</span>, vmax=Rmeep.max())
plt.axis([kxs[<span class="hljs-number">0</span>,<span class="hljs-number">0</span>], kxs[<span class="hljs-number">0</span>,-<span class="hljs-number">1</span>], wvl[-<span class="hljs-number">1</span>], wvl[<span class="hljs-number">0</span>]])
plt.yticks([t <span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> np.arange(<span class="hljs-number">0.4</span>,<span class="hljs-number">0.9</span>,<span class="hljs-number">0.1</span>)])
plt.xlabel(<span class="hljs-string">"Bloch-periodic wavevector ($k_x/2π$)"</span>)
plt.ylabel(<span class="hljs-string">"wavelength (μm)"</span>)
plt.title(<span class="hljs-string">"reflectance (meep)"</span>)
cbar = plt.colorbar()
cbar.set_ticks([t <span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> np.arange(<span class="hljs-number">0</span>,<span class="hljs-number">0.4</span>,<span class="hljs-number">0.1</span>)])
cbar.set_ticklabels([<span class="hljs-string">"{:.1f}"</span>.format(t) <span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> np.arange(<span class="hljs-number">0</span>,<span class="hljs-number">0.4</span>,<span class="hljs-number">0.1</span>)])
plt.show()

plt.figure()
plt.pcolormesh(thetas, wvls, Rmeep, cmap=<span class="hljs-string">'hot'</span>, shading=<span class="hljs-string">'gouraud'</span>, vmin=<span class="hljs-number">0</span>, vmax=Rmeep.max())
plt.axis([thetas.min(), thetas.max(), wvl[-<span class="hljs-number">1</span>], wvl[<span class="hljs-number">0</span>]])
plt.xticks([t <span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> range(<span class="hljs-number">0</span>,<span class="hljs-number">100</span>,<span class="hljs-number">20</span>)])
plt.yticks([t <span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> np.arange(<span class="hljs-number">0.4</span>,<span class="hljs-number">0.9</span>,<span class="hljs-number">0.1</span>)])
plt.xlabel(<span class="hljs-string">"angle of incident planewave (degrees)"</span>)
plt.ylabel(<span class="hljs-string">"wavelength (μm)"</span>)
plt.title(<span class="hljs-string">"reflectance (meep)"</span>)
cbar = plt.colorbar()
cbar.set_ticks([t <span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> np.arange(<span class="hljs-number">0</span>,<span class="hljs-number">0.4</span>,<span class="hljs-number">0.1</span>)])
cbar.set_ticklabels([<span class="hljs-string">"{:.1f}"</span>.format(t) <span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> np.arange(<span class="hljs-number">0</span>,<span class="hljs-number">0.4</span>,<span class="hljs-number">0.1</span>)])
plt.show()

n1=<span class="hljs-number">1</span>
n2=<span class="hljs-number">3.5</span>

<span class="hljs-comment"># compute angle of refracted planewave in medium n2</span>
<span class="hljs-comment"># for incident planewave in medium n1 at angle theta_in</span>
theta_out = <span class="hljs-keyword">lambda</span> theta_in: math.asin(n1*math.sin(theta_in)/n2)

<span class="hljs-comment"># compute Fresnel reflectance for P-polarization in medium n2</span>
<span class="hljs-comment"># for incident planewave in medium n1 at angle theta_in</span>
Rfresnel = <span class="hljs-keyword">lambda</span> theta_in: math.fabs((n1*math.cos(theta_out(theta_in))-n2*math.cos(theta_in))/(n1*math.cos(theta_out(theta_in))+n2*math.cos(theta_in)))**<span class="hljs-number">2</span>

Ranalytic = np.empty((<span class="hljs-number">50</span>, theta_in.size))
<span class="hljs-keyword">for</span> m <span class="hljs-keyword">in</span> range(wvl.size):
    <span class="hljs-keyword">for</span> n <span class="hljs-keyword">in</span> range(theta_in.size):
        Ranalytic[m,n] = Rfresnel(math.radians(thetas[m,n]))

plt.figure()
plt.pcolormesh(thetas, wvls, Ranalytic, cmap=<span class="hljs-string">'hot'</span>, shading=<span class="hljs-string">'gouraud'</span>, vmin=<span class="hljs-number">0</span>, vmax=Ranalytic.max())
plt.axis([thetas.min(), thetas.max(), wvl[-<span class="hljs-number">1</span>], wvl[<span class="hljs-number">0</span>]])
plt.xticks([t <span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> range(<span class="hljs-number">0</span>,<span class="hljs-number">100</span>,<span class="hljs-number">20</span>)])
plt.yticks([t <span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> np.arange(<span class="hljs-number">0.4</span>,<span class="hljs-number">0.9</span>,<span class="hljs-number">0.1</span>)])
plt.xlabel(<span class="hljs-string">"angle of incident planewave (degrees)"</span>)
plt.ylabel(<span class="hljs-string">"wavelength (μm)"</span>)
plt.title(<span class="hljs-string">"reflectance (analytic)"</span>)
cbar = plt.colorbar()
cbar.set_ticks([t <span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> np.arange(<span class="hljs-number">0</span>,<span class="hljs-number">0.4</span>,<span class="hljs-number">0.1</span>)])
cbar.set_ticklabels([<span class="hljs-string">"{:.1f}"</span>.format(t) <span class="hljs-keyword">for</span> t <span class="hljs-keyword">in</span> np.arange(<span class="hljs-number">0</span>,<span class="hljs-number">0.4</span>,<span class="hljs-number">0.1</span>)])
plt.show()
</code></pre>

<p></p><center><img alt="" src="./Tutorial_Basics - MEEP Documentation_files/reflectance_angular_spectrum.png"></center><p></p>
<h2 id="modes-of-a-ring-resonator">Modes of a Ring Resonator</h2>
<p>As described in <a href="https://meep.readthedocs.io/en/latest/Introduction/#resonant-modes">Introduction</a>, another common task for FDTD simulation is to find the resonant modes — frequencies and decay rates — of some cavity structure. You might want to read that again to recall the basic simulation strategy. We will show how this works for a ring resonator, which is simply a waveguide bent into a circle. This script can be also found in <a href="https://github.com/NanoComp/meep/blob/master/python/examples/ring.py">examples/ring.py</a>; the notebook is <a href="https://nbviewer.jupyter.org/github/NanoComp/meep/blob/master/python/examples/ring.ipynb">examples/ring.ipynb</a>. In fact, since this structure has cylindrical symmetry, we can simulate it much more efficiently by using cylindrical coordinates, but for illustration here we'll just use an ordinary 2d simulation.</p>
<p>As before, we'll define some parameters to describe the geometry, so that we can easily change the structure:</p>
<pre><code class="py hljs python">n = <span class="hljs-number">3.4</span>                 <span class="hljs-comment"># index of waveguide</span>
w = <span class="hljs-number">1</span>                   <span class="hljs-comment"># width of waveguide</span>
r = <span class="hljs-number">1</span>                   <span class="hljs-comment"># inner radius of ring</span>
pad = <span class="hljs-number">4</span>                 <span class="hljs-comment"># padding between waveguide and edge of PML</span>
dpml = <span class="hljs-number">2</span>                <span class="hljs-comment"># thickness of PML</span>
sxy = <span class="hljs-number">2</span>*(r+w+pad+dpml)  <span class="hljs-comment"># cell size</span>
</code></pre>

<p>How do we make a circular waveguide? So far, we've only seen <code>Block</code> objects, but Meep also lets you specify cylinders, spheres, ellipsoids, and cones, as well as user-specified dielectric functions. In this case, we'll use two <code>Cylinder</code> objects, one inside the other:</p>
<pre><code class="py hljs python">c1 = mp.Cylinder(radius=r+w, material=mp.Medium(index=n))
c2 = mp.Cylinder(radius=r)
</code></pre>

<p>Later objects in the <code>geometry</code> object take precedence over or rather lie "on top of" earlier objects, so the second <code>air</code> (ε=1) cylinder cuts a circular hole out of the larger cylinder, leaving a ring of width w.</p>
<p>We don't know the frequency of the mode(s) ahead of time, so we'll just hit the structure with a broad Gaussian pulse to excite all of the E<sub>z</sub>-polarized modes in a chosen bandwidth:</p>
<pre><code class="py hljs python">fcen = <span class="hljs-number">0.15</span>              <span class="hljs-comment"># pulse center frequency</span>
df = <span class="hljs-number">0.1</span>                 <span class="hljs-comment"># pulse frequency width</span>
src = mp.Source(mp.GaussianSource(fcen, fwidth=df), mp.Ez, mp.Vector3(r+<span class="hljs-number">0.1</span>))
</code></pre>

<p>Finally, we are ready to run the simulation. The basic idea is to run until the sources are finished, and then to run for some additional period of time. In that additional period, we'll perform some signal processing on the fields at some point with <a href="https://github.com/NanoComp/harminv/blob/master/README.md">Harminv</a> to identify the frequencies and decay rates of the modes that were excited:</p>
<pre><code class="py hljs python">sim = mp.Simulation(cell_size=mp.Vector3(sxy, sxy),
                    geometry=[c1, c2],
                    sources=[src],
                    resolution=<span class="hljs-number">10</span>,                    
                    boundary_layers=[mp.PML(dpml)])

sim.run(mp.at_beginning(mp.output_epsilon),
        mp.after_sources(mp.Harminv(mp.Ez, mp.Vector3(r+<span class="hljs-number">0.1</span>), fcen, df)),
        until_after_sources=<span class="hljs-number">300</span>)
</code></pre>

<p>The signal processing is performed by the <code>Harminv</code> routine, which takes four arguments: the field component E<sub>z</sub> and position (<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-44-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;r&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-299" style="width: 0.537em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.43em; height: 0px; font-size: 117%;"><span style="position: absolute; clip: rect(1.605em, 1000.43em, 2.353em, -999.997em); top: -2.188em; left: 0em;"><span class="mrow" id="MathJax-Span-300"><span class="mi" id="MathJax-Span-301" style="font-family: MathJax_Math-italic;">r</span></span><span style="display: inline-block; width: 0px; height: 2.193em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.628em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>r</mi></math></span></span><script type="math/tex" id="MathJax-Element-44">r</script>+0.1,0) to analyze, and a frequency range given by a center frequency and bandwidth (same as the source pulse). Note that we wrap <code>Harminv</code> in <code>after_sources(...)</code>, since we only want to analyze the frequencies in the source-free system (the presence of a source will distort the analysis). At the end of the run, <code>Harminv</code> prints a series of lines (beginning with <code>harminv0:</code>) listing the frequencies it found:</p>
<pre><code class="hljs matlab">harminv0:,&nbsp;frequency,&nbsp;<span class="hljs-built_in">imag</span>.&nbsp;freq.,&nbsp;Q,&nbsp;|amp|,&nbsp;amplitude,&nbsp;error
harminv0:,&nbsp;<span class="hljs-number">0.118101575043663</span>,&nbsp;-<span class="hljs-number">7.31885828253851e-4</span>,&nbsp;<span class="hljs-number">80.683059081382</span>,&nbsp;<span class="hljs-number">0.00341388964904578</span>,&nbsp;-<span class="hljs-number">0.00305022905294175</span>-<span class="hljs-number">0.00153321402956404</span><span class="hljs-built_in">i</span>,&nbsp;<span class="hljs-number">1.02581433904604e-5</span>
harminv0:,&nbsp;<span class="hljs-number">0.147162555528154</span>,&nbsp;-<span class="hljs-number">2.32636643253225e-4</span>,&nbsp;<span class="hljs-number">316.29272471914</span>,&nbsp;<span class="hljs-number">0.0286457663908165</span>,&nbsp;<span class="hljs-number">0.0193127882016469</span>-<span class="hljs-number">0.0211564681361413</span><span class="hljs-built_in">i</span>,&nbsp;<span class="hljs-number">7.32532621851082e-7</span>
harminv0:,&nbsp;<span class="hljs-number">0.175246750722663</span>,&nbsp;-<span class="hljs-number">5.22349801171605e-5</span>,&nbsp;<span class="hljs-number">1677.48461212767</span>,&nbsp;<span class="hljs-number">0.00721133215656089</span>,&nbsp;-<span class="hljs-number">8.12770506086109e-4</span>-<span class="hljs-number">0.00716538314235085</span><span class="hljs-built_in">i</span>,&nbsp;<span class="hljs-number">1.82066436470489e-7</span>
</code></pre>

<p>There are six, comma-delimited columns in addition to the label. These results are also stored in <code>Harminv.modes</code>. The meaning of these columns is as follows. <code>Harminv</code> analyzes the fields <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-45-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-302" style="width: 2.033em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.712em; height: 0px; font-size: 117%;"><span style="position: absolute; clip: rect(1.338em, 1001.61em, 2.674em, -999.997em); top: -2.241em; left: 0em;"><span class="mrow" id="MathJax-Span-303"><span class="mi" id="MathJax-Span-304" style="font-family: MathJax_Math-italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.056em;"></span></span><span class="mo" id="MathJax-Span-305" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-306" style="font-family: MathJax_Math-italic;">t</span><span class="mo" id="MathJax-Span-307" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.246em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.316em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>f</mi><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-45">f(t)</script> at the given point, and expresses this as a sum of modes in the specified bandwidth:</p>
<p>
<span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-46-Frame" tabindex="0" style="text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mi&gt;f&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;munder&gt;&lt;mo&gt;&amp;#x2211;&lt;/mo&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/munder&gt;&lt;msub&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/msub&gt;&lt;msup&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;msub&gt;&lt;mi&gt;&amp;#x03C9;&lt;/mi&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/msub&gt;&lt;mi&gt;t&lt;/mi&gt;&lt;/mrow&gt;&lt;/msup&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-308" style="width: 9.404em; display: inline-block;"><span style="display: inline-block; position: relative; width: 8.015em; height: 0px; font-size: 117%;"><span style="position: absolute; clip: rect(1.124em, 1008.01em, 3.582em, -999.997em); top: -2.241em; left: 0em;"><span class="mrow" id="MathJax-Span-309"><span class="mi" id="MathJax-Span-310" style="font-family: MathJax_Math-italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.056em;"></span></span><span class="mo" id="MathJax-Span-311" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-312" style="font-family: MathJax_Math-italic;">t</span><span class="mo" id="MathJax-Span-313" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-314" style="font-family: MathJax_Main; padding-left: 0.27em;">=</span><span class="munderover" id="MathJax-Span-315" style="padding-left: 0.27em;"><span style="display: inline-block; position: relative; width: 1.445em; height: 0px;"><span style="position: absolute; clip: rect(2.887em, 1001.39em, 4.597em, -999.997em); top: -4.004em; left: 0em;"><span class="mo" id="MathJax-Span-316" style="font-family: MathJax_Size2; vertical-align: 0em;">∑</span><span style="display: inline-block; width: 0px; height: 4.009em;"></span></span><span style="position: absolute; clip: rect(3.528em, 1000.43em, 4.276em, -999.997em); top: -2.935em; left: 0.537em;"><span class="mi" id="MathJax-Span-317" style="font-size: 70.7%; font-family: MathJax_Math-italic;">n</span><span style="display: inline-block; width: 0px; height: 4.009em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-318" style="padding-left: 0.163em;"><span style="display: inline-block; position: relative; width: 1.018em; height: 0px;"><span style="position: absolute; clip: rect(3.421em, 1000.48em, 4.169em, -999.997em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-319" style="font-family: MathJax_Math-italic;">a</span><span style="display: inline-block; width: 0px; height: 4.009em;"></span></span><span style="position: absolute; top: -3.843em; left: 0.537em;"><span class="mi" id="MathJax-Span-320" style="font-size: 70.7%; font-family: MathJax_Math-italic;">n</span><span style="display: inline-block; width: 0px; height: 4.009em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-321"><span style="display: inline-block; position: relative; width: 2.407em; height: 0px;"><span style="position: absolute; clip: rect(3.421em, 1000.43em, 4.169em, -999.997em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-322" style="font-family: MathJax_Math-italic;">e</span><span style="display: inline-block; width: 0px; height: 4.009em;"></span></span><span style="position: absolute; top: -4.431em; left: 0.483em;"><span class="texatom" id="MathJax-Span-323"><span class="mrow" id="MathJax-Span-324"><span class="mo" id="MathJax-Span-325" style="font-size: 70.7%; font-family: MathJax_Main;">−</span><span class="mi" id="MathJax-Span-326" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span class="msubsup" id="MathJax-Span-327"><span style="display: inline-block; position: relative; width: 0.804em; height: 0px;"><span style="position: absolute; clip: rect(3.528em, 1000.43em, 4.169em, -999.997em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-328" style="font-size: 70.7%; font-family: MathJax_Math-italic;">ω</span><span style="display: inline-block; width: 0px; height: 4.009em;"></span></span><span style="position: absolute; top: -3.897em; left: 0.43em;"><span class="mi" id="MathJax-Span-329" style="font-size: 50%; font-family: MathJax_Math-italic;">n</span><span style="display: inline-block; width: 0px; height: 4.009em;"></span></span></span></span><span class="mi" id="MathJax-Span-330" style="font-size: 70.7%; font-family: MathJax_Math-italic;">t</span></span></span><span style="display: inline-block; width: 0px; height: 4.009em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.246em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.434em; border-left: 0px solid; width: 0px; height: 2.566em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>f</mi><mo stretchy="false">(</mo><mi>t</mi><mo stretchy="false">)</mo><mo>=</mo><munder><mo>∑</mo><mi>n</mi></munder><msub><mi>a</mi><mi>n</mi></msub><msup><mi>e</mi><mrow class="MJX-TeXAtom-ORD"><mo>−</mo><mi>i</mi><msub><mi>ω</mi><mi>n</mi></msub><mi>t</mi></mrow></msup></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-46">f(t) = \sum_n a_n e^{-i \omega_n t}</script>
</p>
<p>for complex amplitudes <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-47-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-331" style="width: 1.231em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.018em; height: 0px; font-size: 117%;"><span style="position: absolute; clip: rect(1.605em, 1001.02em, 2.513em, -999.997em); top: -2.188em; left: 0em;"><span class="mrow" id="MathJax-Span-332"><span class="msubsup" id="MathJax-Span-333"><span style="display: inline-block; position: relative; width: 1.018em; height: 0px;"><span style="position: absolute; clip: rect(3.421em, 1000.48em, 4.169em, -999.997em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-334" style="font-family: MathJax_Math-italic;">a</span><span style="display: inline-block; width: 0px; height: 4.009em;"></span></span><span style="position: absolute; top: -3.843em; left: 0.537em;"><span class="mi" id="MathJax-Span-335" style="font-size: 70.7%; font-family: MathJax_Math-italic;">n</span><span style="display: inline-block; width: 0px; height: 4.009em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.193em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 0.816em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>a</mi><mi>n</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-47">a_n</script> and complex frequencies ω<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-48-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;&lt;/mi&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-336" style="width: 0.59em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.483em; height: 0px; font-size: 117%;"><span style="position: absolute; clip: rect(1.872em, 1000.48em, 2.513em, -999.997em); top: -2.188em; left: 0em;"><span class="mrow" id="MathJax-Span-337"><span class="msubsup" id="MathJax-Span-338"><span style="display: inline-block; position: relative; width: 0.483em; height: 0px;"><span style="position: absolute; clip: rect(3.849em, 1000em, 4.169em, -999.997em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-339"></span><span style="display: inline-block; width: 0px; height: 4.009em;"></span></span><span style="position: absolute; top: -3.843em; left: 0em;"><span class="mi" id="MathJax-Span-340" style="font-size: 70.7%; font-family: MathJax_Math-italic;">n</span><span style="display: inline-block; width: 0px; height: 4.009em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.193em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 0.503em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi></mi><mi>n</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-48">_n</script>. The six columns relate to these quantities. The first column is the <em>real</em> part of ω<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-49-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;&lt;/mi&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-341" style="width: 0.59em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.483em; height: 0px; font-size: 117%;"><span style="position: absolute; clip: rect(1.872em, 1000.48em, 2.513em, -999.997em); top: -2.188em; left: 0em;"><span class="mrow" id="MathJax-Span-342"><span class="msubsup" id="MathJax-Span-343"><span style="display: inline-block; position: relative; width: 0.483em; height: 0px;"><span style="position: absolute; clip: rect(3.849em, 1000em, 4.169em, -999.997em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-344"></span><span style="display: inline-block; width: 0px; height: 4.009em;"></span></span><span style="position: absolute; top: -3.843em; left: 0em;"><span class="mi" id="MathJax-Span-345" style="font-size: 70.7%; font-family: MathJax_Math-italic;">n</span><span style="display: inline-block; width: 0px; height: 4.009em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.193em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 0.503em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi></mi><mi>n</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-49">_n</script>, expressed in our usual 2πc units, and the second column is the <em>imaginary</em> part — a negative imaginary part corresponds to an exponential decay. This decay rate, for a cavity, is more often expressed as a dimensionless "lifetime" <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-50-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-346" style="width: 0.964em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.804em; height: 0px; font-size: 117%;"><span style="position: absolute; clip: rect(1.338em, 1000.75em, 2.567em, -999.997em); top: -2.188em; left: 0em;"><span class="mrow" id="MathJax-Span-347"><span class="mi" id="MathJax-Span-348" style="font-family: MathJax_Math-italic;">Q</span></span><span style="display: inline-block; width: 0px; height: 2.193em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.191em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>Q</mi></math></span></span><script type="math/tex" id="MathJax-Element-50">Q</script>, defined by:</p>
<p>
<span class="MathJax_Preview" style="color: inherit; display: none;"></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-51-Frame" tabindex="0" style="text-align: center; position: relative;" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot; display=&quot;block&quot;&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;mo&gt;=&lt;/mo&gt;&lt;mfrac&gt;&lt;mrow&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;R&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;e&lt;/mi&gt;&lt;/mrow&gt;&lt;mspace width=&quot;thinmathspace&quot; /&gt;&lt;mi&gt;&amp;#x03C9;&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;I&lt;/mi&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;m&lt;/mi&gt;&lt;/mrow&gt;&lt;mspace width=&quot;thinmathspace&quot; /&gt;&lt;mi&gt;&amp;#x03C9;&lt;/mi&gt;&lt;/mrow&gt;&lt;/mfrac&gt;&lt;mo&gt;.&lt;/mo&gt;&lt;/math&gt;" role="presentation"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-349" style="width: 7.001em; display: inline-block;"><span style="display: inline-block; position: relative; width: 5.986em; height: 0px; font-size: 117%;"><span style="position: absolute; clip: rect(0.751em, 1005.93em, 3.154em, -999.997em); top: -2.241em; left: 0em;"><span class="mrow" id="MathJax-Span-350"><span class="mi" id="MathJax-Span-351" style="font-family: MathJax_Math-italic;">Q</span><span class="mo" id="MathJax-Span-352" style="font-family: MathJax_Main; padding-left: 0.27em;">=</span><span class="mfrac" id="MathJax-Span-353" style="padding-left: 0.27em;"><span style="display: inline-block; position: relative; width: 3.368em; height: 0px; margin-right: 0.11em; margin-left: 0.11em;"><span style="position: absolute; clip: rect(3.154em, 1001.98em, 4.169em, -999.997em); top: -4.698em; left: 50%; margin-left: -0.959em;"><span class="mrow" id="MathJax-Span-354"><span class="texatom" id="MathJax-Span-355"><span class="mrow" id="MathJax-Span-356"><span class="mi" id="MathJax-Span-357" style="font-family: MathJax_Main;">R</span><span class="mi" id="MathJax-Span-358" style="font-family: MathJax_Main;">e</span></span></span><span class="mspace" id="MathJax-Span-359" style="height: 0em; vertical-align: 0em; width: 0.163em; display: inline-block; overflow: hidden;"></span><span class="mi" id="MathJax-Span-360" style="font-family: MathJax_Math-italic;">ω</span></span><span style="display: inline-block; width: 0px; height: 4.009em;"></span></span><span style="position: absolute; clip: rect(3.154em, 1003.26em, 4.276em, -999.997em); top: -3.309em; left: 50%; margin-left: -1.653em;"><span class="mrow" id="MathJax-Span-361"><span class="mo" id="MathJax-Span-362" style="font-family: MathJax_Main;">−</span><span class="mn" id="MathJax-Span-363" style="font-family: MathJax_Main;">2</span><span class="texatom" id="MathJax-Span-364"><span class="mrow" id="MathJax-Span-365"><span class="mi" id="MathJax-Span-366" style="font-family: MathJax_Main;">I</span><span class="mi" id="MathJax-Span-367" style="font-family: MathJax_Main;">m</span></span></span><span class="mspace" id="MathJax-Span-368" style="height: 0em; vertical-align: 0em; width: 0.163em; display: inline-block; overflow: hidden;"></span><span class="mi" id="MathJax-Span-369" style="font-family: MathJax_Math-italic;">ω</span></span><span style="display: inline-block; width: 0px; height: 4.009em;"></span></span><span style="position: absolute; clip: rect(0.857em, 1003.37em, 1.231em, -999.997em); top: -1.279em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 3.368em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.071em;"></span></span></span></span><span class="mo" id="MathJax-Span-370" style="font-family: MathJax_Main;">.</span></span><span style="display: inline-block; width: 0px; height: 2.246em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.934em; border-left: 0px solid; width: 0px; height: 2.628em;"></span></span></nobr><span class="MJX_Assistive_MathML MJX_Assistive_MathML_Block" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML" display="block"><mi>Q</mi><mo>=</mo><mfrac><mrow><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="normal">R</mi><mi mathvariant="normal">e</mi></mrow><mspace width="thinmathspace"></mspace><mi>ω</mi></mrow><mrow><mo>−</mo><mn>2</mn><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="normal">I</mi><mi mathvariant="normal">m</mi></mrow><mspace width="thinmathspace"></mspace><mi>ω</mi></mrow></mfrac><mo>.</mo></math></span></span></div><script type="math/tex; mode=display" id="MathJax-Element-51">Q = \frac{\mathrm{Re}\,\omega}{-2 \mathrm{Im}\,\omega}.</script>
</p>
<p>
<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-52-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-371" style="width: 0.964em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.804em; height: 0px; font-size: 117%;"><span style="position: absolute; clip: rect(1.338em, 1000.75em, 2.567em, -999.997em); top: -2.188em; left: 0em;"><span class="mrow" id="MathJax-Span-372"><span class="mi" id="MathJax-Span-373" style="font-family: MathJax_Math-italic;">Q</span></span><span style="display: inline-block; width: 0px; height: 2.193em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.191em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>Q</mi></math></span></span><script type="math/tex" id="MathJax-Element-52">Q</script> is the number of optical periods for the energy to decay by <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-53-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;exp&lt;/mi&gt;&lt;mo&gt;&amp;#x2061;&lt;/mo&gt;&lt;mo stretchy=&quot;false&quot;&gt;(&lt;/mo&gt;&lt;mo&gt;&amp;#x2212;&lt;/mo&gt;&lt;mn&gt;2&lt;/mn&gt;&lt;mi&gt;&amp;#x03C0;&lt;/mi&gt;&lt;mo stretchy=&quot;false&quot;&gt;)&lt;/mo&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-374" style="width: 4.917em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.169em; height: 0px; font-size: 117%;"><span style="position: absolute; clip: rect(1.338em, 1004.06em, 2.674em, -999.997em); top: -2.241em; left: 0em;"><span class="mrow" id="MathJax-Span-375"><span class="mi" id="MathJax-Span-376" style="font-family: MathJax_Main;">exp</span><span class="mo" id="MathJax-Span-377"></span><span class="mo" id="MathJax-Span-378" style="font-family: MathJax_Main;">(</span><span class="mo" id="MathJax-Span-379" style="font-family: MathJax_Main;">−</span><span class="mn" id="MathJax-Span-380" style="font-family: MathJax_Main;">2</span><span class="mi" id="MathJax-Span-381" style="font-family: MathJax_Math-italic;">π<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span><span class="mo" id="MathJax-Span-382" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.246em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.316em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>exp</mi><mo>⁡</mo><mo stretchy="false">(</mo><mo>−</mo><mn>2</mn><mi>π</mi><mo stretchy="false">)</mo></math></span></span><script type="math/tex" id="MathJax-Element-53">\exp(-2\pi)</script>, and 1/<span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-54-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-383" style="width: 0.964em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.804em; height: 0px; font-size: 117%;"><span style="position: absolute; clip: rect(1.338em, 1000.75em, 2.567em, -999.997em); top: -2.188em; left: 0em;"><span class="mrow" id="MathJax-Span-384"><span class="mi" id="MathJax-Span-385" style="font-family: MathJax_Math-italic;">Q</span></span><span style="display: inline-block; width: 0px; height: 2.193em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.191em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>Q</mi></math></span></span><script type="math/tex" id="MathJax-Element-54">Q</script> is the fractional bandwidth at half-maximum of the resonance peak in Fourier domain. This <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-55-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-386" style="width: 0.964em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.804em; height: 0px; font-size: 117%;"><span style="position: absolute; clip: rect(1.338em, 1000.75em, 2.567em, -999.997em); top: -2.188em; left: 0em;"><span class="mrow" id="MathJax-Span-387"><span class="mi" id="MathJax-Span-388" style="font-family: MathJax_Math-italic;">Q</span></span><span style="display: inline-block; width: 0px; height: 2.193em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.191em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>Q</mi></math></span></span><script type="math/tex" id="MathJax-Element-55">Q</script> is the third column of the output. The fourth and fifth columns are the absolute value <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-56-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;msub&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/msub&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo stretchy=&quot;false&quot;&gt;|&lt;/mo&gt;&lt;/mrow&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-389" style="width: 1.819em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.552em; height: 0px; font-size: 117%;"><span style="position: absolute; clip: rect(1.338em, 1001.45em, 2.674em, -999.997em); top: -2.241em; left: 0em;"><span class="mrow" id="MathJax-Span-390"><span class="texatom" id="MathJax-Span-391"><span class="mrow" id="MathJax-Span-392"><span class="mo" id="MathJax-Span-393" style="font-family: MathJax_Main;">|</span></span></span><span class="msubsup" id="MathJax-Span-394"><span style="display: inline-block; position: relative; width: 1.018em; height: 0px;"><span style="position: absolute; clip: rect(3.421em, 1000.48em, 4.169em, -999.997em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-395" style="font-family: MathJax_Math-italic;">a</span><span style="display: inline-block; width: 0px; height: 4.009em;"></span></span><span style="position: absolute; top: -3.843em; left: 0.537em;"><span class="mi" id="MathJax-Span-396" style="font-size: 70.7%; font-family: MathJax_Math-italic;">n</span><span style="display: inline-block; width: 0px; height: 4.009em;"></span></span></span></span><span class="texatom" id="MathJax-Span-397"><span class="mrow" id="MathJax-Span-398"><span class="mo" id="MathJax-Span-399" style="font-family: MathJax_Main;">|</span></span></span></span><span style="display: inline-block; width: 0px; height: 2.246em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.316em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow><msub><mi>a</mi><mi>n</mi></msub><mrow class="MJX-TeXAtom-ORD"><mo stretchy="false">|</mo></mrow></math></span></span><script type="math/tex" id="MathJax-Element-56">|a_n|</script> and complex amplitudes <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-57-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;a&lt;/mi&gt;&lt;mi&gt;n&lt;/mi&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-400" style="width: 1.231em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.018em; height: 0px; font-size: 117%;"><span style="position: absolute; clip: rect(1.605em, 1001.02em, 2.513em, -999.997em); top: -2.188em; left: 0em;"><span class="mrow" id="MathJax-Span-401"><span class="msubsup" id="MathJax-Span-402"><span style="display: inline-block; position: relative; width: 1.018em; height: 0px;"><span style="position: absolute; clip: rect(3.421em, 1000.48em, 4.169em, -999.997em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-403" style="font-family: MathJax_Math-italic;">a</span><span style="display: inline-block; width: 0px; height: 4.009em;"></span></span><span style="position: absolute; top: -3.843em; left: 0.537em;"><span class="mi" id="MathJax-Span-404" style="font-size: 70.7%; font-family: MathJax_Math-italic;">n</span><span style="display: inline-block; width: 0px; height: 4.009em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.193em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 0.816em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>a</mi><mi>n</mi></msub></math></span></span><script type="math/tex" id="MathJax-Element-57">a_n</script>. The last column is a crude measure of the error in the frequency (both real and imaginary). If the error is much larger than the imaginary part, for example, then you can't trust the <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-58-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-405" style="width: 0.964em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.804em; height: 0px; font-size: 117%;"><span style="position: absolute; clip: rect(1.338em, 1000.75em, 2.567em, -999.997em); top: -2.188em; left: 0em;"><span class="mrow" id="MathJax-Span-406"><span class="mi" id="MathJax-Span-407" style="font-family: MathJax_Math-italic;">Q</span></span><span style="display: inline-block; width: 0px; height: 2.193em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.191em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>Q</mi></math></span></span><script type="math/tex" id="MathJax-Element-58">Q</script> to be accurate. Note: this error is only the <em>uncertainty in the signal processing</em>, and tells you nothing about the errors from finite resolution, finite cell size, and so on.</p>
<p>An interesting question is how long should we run the simulation, after the sources are turned off, in order to analyze the frequencies. With traditional Fourier analysis, the time would be proportional to the frequency resolution required, but with <code>Harminv</code> the time is much shorter. For example, there are three modes. The last has a <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-59-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-408" style="width: 0.964em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.804em; height: 0px; font-size: 117%;"><span style="position: absolute; clip: rect(1.338em, 1000.75em, 2.567em, -999.997em); top: -2.188em; left: 0em;"><span class="mrow" id="MathJax-Span-409"><span class="mi" id="MathJax-Span-410" style="font-family: MathJax_Math-italic;">Q</span></span><span style="display: inline-block; width: 0px; height: 2.193em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.191em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>Q</mi></math></span></span><script type="math/tex" id="MathJax-Element-59">Q</script> of 1677, which means that the mode decays for about 2000 periods or about 2000/0.175 = 10<sup>4</sup> time units. We have only analyzed it for about 300 time units, however, and the estimated uncertainty in the frequency is 10<sup>-7</sup> (with an actual error of about 10<sup>-6</sup>, from below). In general, you need to increase the run time to get more accuracy, and to find very high <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-60-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-411" style="width: 0.964em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.804em; height: 0px; font-size: 117%;"><span style="position: absolute; clip: rect(1.338em, 1000.75em, 2.567em, -999.997em); top: -2.188em; left: 0em;"><span class="mrow" id="MathJax-Span-412"><span class="mi" id="MathJax-Span-413" style="font-family: MathJax_Math-italic;">Q</span></span><span style="display: inline-block; width: 0px; height: 2.193em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.191em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>Q</mi></math></span></span><script type="math/tex" id="MathJax-Element-60">Q</script> values, but not by much. In some cases, modes with <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-61-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-414" style="width: 0.964em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.804em; height: 0px; font-size: 117%;"><span style="position: absolute; clip: rect(1.338em, 1000.75em, 2.567em, -999.997em); top: -2.188em; left: 0em;"><span class="mrow" id="MathJax-Span-415"><span class="mi" id="MathJax-Span-416" style="font-family: MathJax_Math-italic;">Q</span></span><span style="display: inline-block; width: 0px; height: 2.193em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.191em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>Q</mi></math></span></span><script type="math/tex" id="MathJax-Element-61">Q</script> of around 10<sup>9</sup> can be found with only 200 periods.</p>
<p>In this case, we found three modes in the specified bandwidth, at frequencies of 0.118, 0.147, and 0.175, with corresponding <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-62-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-417" style="width: 0.964em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.804em; height: 0px; font-size: 117%;"><span style="position: absolute; clip: rect(1.338em, 1000.75em, 2.567em, -999.997em); top: -2.188em; left: 0em;"><span class="mrow" id="MathJax-Span-418"><span class="mi" id="MathJax-Span-419" style="font-family: MathJax_Math-italic;">Q</span></span><span style="display: inline-block; width: 0px; height: 2.193em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.191em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>Q</mi></math></span></span><script type="math/tex" id="MathJax-Element-62">Q</script> values of 81, 316, and 1677. As was shown by <a href="https://ieeexplore.ieee.org/document/6769758/">Marcatilli in 1969</a>, the <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-63-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-420" style="width: 0.964em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.804em; height: 0px; font-size: 117%;"><span style="position: absolute; clip: rect(1.338em, 1000.75em, 2.567em, -999.997em); top: -2.188em; left: 0em;"><span class="mrow" id="MathJax-Span-421"><span class="mi" id="MathJax-Span-422" style="font-family: MathJax_Math-italic;">Q</span></span><span style="display: inline-block; width: 0px; height: 2.193em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.191em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>Q</mi></math></span></span><script type="math/tex" id="MathJax-Element-63">Q</script> of a ring resonator increases <em>exponentially</em> with the product of ω and ring radius. Suppose that we want to actually see the field patterns of these modes. No problem: we just re-run the simulation with a <em>narrow</em>-band source around each mode and output the field at the end.</p>
<p>In particular, to output the field at the end we might add an <code>at_end(mp.output_efield_z)</code> argument to our <code>run_after_sources</code> routine, but this is problematic: we might be unlucky and output at a time when the E<sub>z</sub> field is almost zero (i.e. when all of the energy is in the magnetic field), in which case the picture will be deceptive. Instead, at the end of the run we'll output 20 field snapshots over a whole period 1/<code>fcen</code> by appending the command:</p>
<pre><code class="py hljs python">sim.run(mp.at_every(<span class="hljs-number">1</span>/fcen/<span class="hljs-number">20</span>, mp.output_efield_z), until=<span class="hljs-number">1</span>/fcen)
</code></pre>

<p>We can get our modes just by changing two parameters and re-running:</p>
<pre><code class="py hljs python">fcen=<span class="hljs-number">0.118</span>
df=<span class="hljs-number">0.01</span>
</code></pre>

<p>After each one of these commands, we'll convert the fields into PNG images and thence into an animated GIF (as with the bend movie, above), via:</p>
<pre><code class="sh hljs bash">unix%&nbsp;h5topng&nbsp;-RZc&nbsp;dkbluered&nbsp;-C&nbsp;ring-eps-<span class="hljs-number">000000.00</span>.h5&nbsp;ring-ez-*.h5
unix%&nbsp;convert&nbsp;ring-ez-*.png&nbsp;ring-ez-<span class="hljs-number">0.118</span>.gif
</code></pre>

<p>The resulting animations for (from left to right) 0.118, 0.147, and 0.175, are below, in which you can clearly see the radiating fields that produce the losses:</p>
<p></p><center>
<img alt="" src="./Tutorial_Basics - MEEP Documentation_files/Tut-ring-ez-0.118.gif">
<img alt="" src="./Tutorial_Basics - MEEP Documentation_files/Tut-ring-ez-0.147.gif">
<img alt="" src="./Tutorial_Basics - MEEP Documentation_files/Tut-ring-ez-0.175.gif">
</center><p></p>
<p>Each of these modes is, of course, doubly-degenerate according to the representations of the <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-64-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msub&gt;&lt;mi&gt;C&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;&amp;#x221E;&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi mathvariant=&quot;normal&quot;&gt;v&lt;/mi&gt;&lt;/mrow&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-423" style="width: 2.193em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.872em; height: 0px; font-size: 117%;"><span style="position: absolute; clip: rect(1.338em, 1001.87em, 2.513em, -999.997em); top: -2.188em; left: 0em;"><span class="mrow" id="MathJax-Span-424"><span class="msubsup" id="MathJax-Span-425"><span style="display: inline-block; position: relative; width: 1.872em; height: 0px;"><span style="position: absolute; clip: rect(3.154em, 1000.75em, 4.169em, -999.997em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-426" style="font-family: MathJax_Math-italic;">C<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.056em;"></span></span><span style="display: inline-block; width: 0px; height: 4.009em;"></span></span><span style="position: absolute; top: -3.843em; left: 0.697em;"><span class="texatom" id="MathJax-Span-427"><span class="mrow" id="MathJax-Span-428"><span class="mi" id="MathJax-Span-429" style="font-size: 70.7%; font-family: MathJax_Main;">∞</span><span class="texatom" id="MathJax-Span-430"><span class="mrow" id="MathJax-Span-431"><span class="mi" id="MathJax-Span-432" style="font-size: 70.7%; font-family: MathJax_Main;">v</span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.009em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.193em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.128em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msub><mi>C</mi><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="normal">∞</mi><mrow class="MJX-TeXAtom-ORD"><mi mathvariant="normal">v</mi></mrow></mrow></msub></math></span></span><script type="math/tex" id="MathJax-Element-64">C_{\infty\mathrm{v}}</script> symmetry group. The other mode is simply a slight rotation of this mode to make it <em>odd</em> through the <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-65-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-433" style="width: 0.697em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.59em; height: 0px; font-size: 117%;"><span style="position: absolute; clip: rect(1.605em, 1000.54em, 2.353em, -999.997em); top: -2.188em; left: 0em;"><span class="mrow" id="MathJax-Span-434"><span class="mi" id="MathJax-Span-435" style="font-family: MathJax_Math-italic;">x</span></span><span style="display: inline-block; width: 0px; height: 2.193em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.628em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>x</mi></math></span></span><script type="math/tex" id="MathJax-Element-65">x</script> axis, whereas we excited only the <em>even</em> modes due to our source symmetry. Equivalently, one can form clockwise and counter-clockwise propagating modes by taking linear combinations of the even/odd modes, corresponding to an angular <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-66-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;&amp;#x03D5;&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-436" style="width: 0.697em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.59em; height: 0px; font-size: 117%;"><span style="position: absolute; clip: rect(1.338em, 1000.59em, 2.567em, -999.997em); top: -2.188em; left: 0em;"><span class="mrow" id="MathJax-Span-437"><span class="mi" id="MathJax-Span-438" style="font-family: MathJax_Math-italic;">ϕ</span></span><span style="display: inline-block; width: 0px; height: 2.193em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.191em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>ϕ</mi></math></span></span><script type="math/tex" id="MathJax-Element-66">\phi</script> dependence <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-67-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msup&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mo&gt;&amp;#x00B1;&lt;/mo&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mi&gt;m&lt;/mi&gt;&lt;mi&gt;&amp;#x03D5;&lt;/mi&gt;&lt;/mrow&gt;&lt;/msup&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-439" style="width: 2.834em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.407em; height: 0px; font-size: 117%;"><span style="position: absolute; clip: rect(1.178em, 1002.41em, 2.353em, -999.997em); top: -2.188em; left: 0em;"><span class="mrow" id="MathJax-Span-440"><span class="msubsup" id="MathJax-Span-441"><span style="display: inline-block; position: relative; width: 2.407em; height: 0px;"><span style="position: absolute; clip: rect(3.421em, 1000.43em, 4.169em, -999.997em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-442" style="font-family: MathJax_Math-italic;">e</span><span style="display: inline-block; width: 0px; height: 4.009em;"></span></span><span style="position: absolute; top: -4.378em; left: 0.483em;"><span class="texatom" id="MathJax-Span-443"><span class="mrow" id="MathJax-Span-444"><span class="mo" id="MathJax-Span-445" style="font-size: 70.7%; font-family: MathJax_Main;">±</span><span class="mi" id="MathJax-Span-446" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span class="mi" id="MathJax-Span-447" style="font-size: 70.7%; font-family: MathJax_Math-italic;">m</span><span class="mi" id="MathJax-Span-448" style="font-size: 70.7%; font-family: MathJax_Math-italic;">ϕ</span></span></span><span style="display: inline-block; width: 0px; height: 4.009em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.193em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.128em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mi>e</mi><mrow class="MJX-TeXAtom-ORD"><mo>±</mo><mi>i</mi><mi>m</mi><mi>ϕ</mi></mrow></msup></math></span></span><script type="math/tex" id="MathJax-Element-67">e^{\pm i m\phi}</script> for m=3, 4, and 5 in this case.</p>
<p>You may have noticed, by the way, that when you run with the narrow-bandwidth source, <code>Harminv</code> gives you slightly different frequency and <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-68-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-449" style="width: 0.964em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.804em; height: 0px; font-size: 117%;"><span style="position: absolute; clip: rect(1.338em, 1000.75em, 2.567em, -999.997em); top: -2.188em; left: 0em;"><span class="mrow" id="MathJax-Span-450"><span class="mi" id="MathJax-Span-451" style="font-family: MathJax_Math-italic;">Q</span></span><span style="display: inline-block; width: 0px; height: 2.193em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.191em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>Q</mi></math></span></span><script type="math/tex" id="MathJax-Element-68">Q</script> estimates, with a much smaller error estimate — this is not too strange, since by exciting a single mode you generate a cleaner signal that can be analyzed more accurately. For example, the narrow-bandwidth source for the ω=0.175 mode gives:</p>
<pre><code class="hljs matlab">harminv0:,&nbsp;<span class="hljs-number">0.175247426698716</span>,&nbsp;-<span class="hljs-number">5.20844416909221e-5</span>,&nbsp;<span class="hljs-number">1682.33949533974</span>,&nbsp;<span class="hljs-number">0.185515412838043</span>,&nbsp;<span class="hljs-number">0.127625313330642</span>-<span class="hljs-number">0.13463932485617</span><span class="hljs-built_in">i</span>,&nbsp;<span class="hljs-number">7.35320734698267e-12</span>
</code></pre>

<p>which differs by about 10<sup>-6</sup> from the earlier estimate; the difference in <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-69-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;Q&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-452" style="width: 0.964em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.804em; height: 0px; font-size: 117%;"><span style="position: absolute; clip: rect(1.338em, 1000.75em, 2.567em, -999.997em); top: -2.188em; left: 0em;"><span class="mrow" id="MathJax-Span-453"><span class="mi" id="MathJax-Span-454" style="font-family: MathJax_Math-italic;">Q</span></span><span style="display: inline-block; width: 0px; height: 2.193em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.191em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>Q</mi></math></span></span><script type="math/tex" id="MathJax-Element-69">Q</script> is, of course, larger because a small absolute error in ω gives a larger relative error in the small imaginary frequency.</p>
<h3 id="exploiting-symmetry">Exploiting Symmetry</h3>
<p>In this case, because we have a mirror symmetry plane (the <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-70-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-455" style="width: 0.697em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.59em; height: 0px; font-size: 117%;"><span style="position: absolute; clip: rect(1.605em, 1000.54em, 2.353em, -999.997em); top: -2.188em; left: 0em;"><span class="mrow" id="MathJax-Span-456"><span class="mi" id="MathJax-Span-457" style="font-family: MathJax_Math-italic;">x</span></span><span style="display: inline-block; width: 0px; height: 2.193em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.628em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>x</mi></math></span></span><script type="math/tex" id="MathJax-Element-70">x</script> axis) that preserves both the structure and the sources, we can exploit this mirror symmetry to speed up the computation. See also <a href="https://meep.readthedocs.io/en/latest/Exploiting_Symmetry/">Exploiting Symmetry</a>. In particular, everything about the script is the same except that we specify an additional object for the <code>Simulation</code> class:</p>
<pre><code class="py hljs python">symmetries=[mp.Mirror(mp.Y)]
</code></pre>

<p>This tells Meep to exploit a mirror-symmetry plane through the origin perpendicular to the <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-71-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-458" style="width: 0.59em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.483em; height: 0px; font-size: 117%;"><span style="position: absolute; clip: rect(1.605em, 1000.48em, 2.567em, -999.997em); top: -2.188em; left: 0em;"><span class="mrow" id="MathJax-Span-459"><span class="mi" id="MathJax-Span-460" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.193em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 0.878em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>y</mi></math></span></span><script type="math/tex" id="MathJax-Element-71">y</script> direction. Meep does not check whether your system really has this symmetry — you should only specify symmetries that really preserve your structure and your sources.</p>
<p>Everything else about your simulation is the same: you can still get the fields at any point, the output file still covers the whole ring, and the harminv outputs are exactly the same. Internally, however, Meep is only doing computations with half of the structure, and the simulation is around twice as fast.</p>
<p>In general, the symmetry of the sources may require some phase. For example, if our source was in the <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-72-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;y&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-461" style="width: 0.59em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.483em; height: 0px; font-size: 117%;"><span style="position: absolute; clip: rect(1.605em, 1000.48em, 2.567em, -999.997em); top: -2.188em; left: 0em;"><span class="mrow" id="MathJax-Span-462"><span class="mi" id="MathJax-Span-463" style="font-family: MathJax_Math-italic;">y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.193em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 0.878em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>y</mi></math></span></span><script type="math/tex" id="MathJax-Element-72">y</script> direction instead of the <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-73-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;z&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-464" style="width: 0.59em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.483em; height: 0px; font-size: 117%;"><span style="position: absolute; clip: rect(1.605em, 1000.48em, 2.353em, -999.997em); top: -2.188em; left: 0em;"><span class="mrow" id="MathJax-Span-465"><span class="mi" id="MathJax-Span-466" style="font-family: MathJax_Math-italic;">z<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.003em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.193em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.628em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>z</mi></math></span></span><script type="math/tex" id="MathJax-Element-73">z</script> direction, then the source would be <em>odd</em> under mirror flips through the <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-74-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;mi&gt;x&lt;/mi&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-467" style="width: 0.697em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.59em; height: 0px; font-size: 117%;"><span style="position: absolute; clip: rect(1.605em, 1000.54em, 2.353em, -999.997em); top: -2.188em; left: 0em;"><span class="mrow" id="MathJax-Span-468"><span class="mi" id="MathJax-Span-469" style="font-family: MathJax_Math-italic;">x</span></span><span style="display: inline-block; width: 0px; height: 2.193em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.628em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><mi>x</mi></math></span></span><script type="math/tex" id="MathJax-Element-74">x</script> axis. We would specify this by <code>mp.Mirror(mp.Y, phase=-1)</code>. See <a href="https://meep.readthedocs.io/en/latest/Python_User_Interface/#symmetry">User Interface</a> for more symmetry possibilities.</p>
<p>In this case, we actually have a lot more symmetry that we could potentially exploit, if we are willing to restrict the symmetry of our source/fields to a particular angular momentum (i.e. angular dependence <span class="MathJax_Preview" style="color: inherit; display: none;"></span><span class="MathJax" id="MathJax-Element-75-Frame" tabindex="0" data-mathml="&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;msup&gt;&lt;mi&gt;e&lt;/mi&gt;&lt;mrow class=&quot;MJX-TeXAtom-ORD&quot;&gt;&lt;mi&gt;i&lt;/mi&gt;&lt;mi&gt;m&lt;/mi&gt;&lt;mi&gt;&amp;#x03D5;&lt;/mi&gt;&lt;/mrow&gt;&lt;/msup&gt;&lt;/math&gt;" role="presentation" style="position: relative;"><nobr aria-hidden="true"><span class="math" id="MathJax-Span-470" style="width: 2.139em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.819em; height: 0px; font-size: 117%;"><span style="position: absolute; clip: rect(1.178em, 1001.82em, 2.353em, -999.997em); top: -2.188em; left: 0em;"><span class="mrow" id="MathJax-Span-471"><span class="msubsup" id="MathJax-Span-472"><span style="display: inline-block; position: relative; width: 1.819em; height: 0px;"><span style="position: absolute; clip: rect(3.421em, 1000.43em, 4.169em, -999.997em); top: -4.004em; left: 0em;"><span class="mi" id="MathJax-Span-473" style="font-family: MathJax_Math-italic;">e</span><span style="display: inline-block; width: 0px; height: 4.009em;"></span></span><span style="position: absolute; top: -4.378em; left: 0.483em;"><span class="texatom" id="MathJax-Span-474"><span class="mrow" id="MathJax-Span-475"><span class="mi" id="MathJax-Span-476" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span class="mi" id="MathJax-Span-477" style="font-size: 70.7%; font-family: MathJax_Math-italic;">m</span><span class="mi" id="MathJax-Span-478" style="font-size: 70.7%; font-family: MathJax_Math-italic;">ϕ</span></span></span><span style="display: inline-block; width: 0px; height: 4.009em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.193em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.128em;"></span></span></nobr><span class="MJX_Assistive_MathML" role="presentation"><math xmlns="http://www.w3.org/1998/Math/MathML"><msup><mi>e</mi><mrow class="MJX-TeXAtom-ORD"><mi>i</mi><mi>m</mi><mi>ϕ</mi></mrow></msup></math></span></span><script type="math/tex" id="MathJax-Element-75">e^{im\phi}</script>). See also <a href="https://meep.readthedocs.io/en/latest/Python_Tutorials/Ring_Resonator_in_Cylindrical_Coordinates/">Tutorial/Ring Resonator in Cylindrical Coordinates</a> for how to solve for modes of this cylindrical geometry much more efficiently.</p>
<h2 id="visualizing-3d-structures">Visualizing 3d Structures</h2>
<p>The previous examples were based on a 1d or 2d cell in which the structure and fields can be visualized using the plotting routines in Matplotlib. In order to visualize 3d structures, you can use <a href="https://docs.enthought.com/mayavi/mayavi/">Mayavi</a>. The following example involves a hexagonal <a href="https://meep.readthedocs.io/en/latest/Python_User_Interface/#prism">prism</a> with index 3.5 perforated by a <a href="https://meep.readthedocs.io/en/latest/Python_User_Interface/#cone">conical</a> hole. There are no other simulation parameters specified. The permittivity data is visualized using an isosurface plot via the <a href="http://docs.enthought.com/mayavi/mayavi/auto/mlab_helper_functions.html#mayavi.mlab.contour3d">contour3d</a> module. (This functionality is automated by the <a href="https://meep.readthedocs.io/en/latest/Python_User_Interface/#data-visualization"><code>plot3D</code></a> routine.) A snapshot of this plot is shown below. For visualization of the vector fields in 3d, you can use the <a href="http://docs.enthought.com/mayavi/mayavi/auto/mlab_helper_functions.html#mayavi.mlab.quiver3d">quiver3d</a> module.</p>
<pre><code class="py hljs python"><span class="hljs-keyword">import</span> meep <span class="hljs-keyword">as</span> mp
<span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np
<span class="hljs-keyword">import</span> math

cell_size = mp.Vector3(<span class="hljs-number">2</span>,<span class="hljs-number">2</span>,<span class="hljs-number">2</span>)

<span class="hljs-comment"># A hexagon is defined as a prism with six vertices centered on the origin</span>
vertices = [mp.Vector3(-<span class="hljs-number">1</span>,<span class="hljs-number">0</span>),
            mp.Vector3(-<span class="hljs-number">0.5</span>,math.sqrt(<span class="hljs-number">3</span>)/<span class="hljs-number">2</span>),
            mp.Vector3(<span class="hljs-number">0.5</span>,math.sqrt(<span class="hljs-number">3</span>)/<span class="hljs-number">2</span>),
            mp.Vector3(<span class="hljs-number">1</span>,<span class="hljs-number">0</span>),
            mp.Vector3(<span class="hljs-number">0.5</span>,-math.sqrt(<span class="hljs-number">3</span>)/<span class="hljs-number">2</span>),
            mp.Vector3(-<span class="hljs-number">0.5</span>,-math.sqrt(<span class="hljs-number">3</span>)/<span class="hljs-number">2</span>)]

geometry = [mp.Prism(vertices, height=<span class="hljs-number">1.0</span>, material=mp.Medium(index=<span class="hljs-number">3.5</span>)),
            mp.Cone(radius=<span class="hljs-number">1.0</span>, radius2=<span class="hljs-number">0.1</span>, height=<span class="hljs-number">2.0</span>, material=mp.air)]

sim = mp.Simulation(resolution=<span class="hljs-number">50</span>,
                    cell_size=cell_size,
                    geometry=geometry)

sim.init_sim()

eps_data = sim.get_epsilon()

<span class="hljs-keyword">from</span> mayavi <span class="hljs-keyword">import</span> mlab
s = mlab.contour3d(eps_data, colormap=<span class="hljs-string">"YlGnBu"</span>)
mlab.show()
</code></pre>

<p></p><center>
<img alt="" src="./Tutorial_Basics - MEEP Documentation_files/prism_epsilon.png">
</center><p></p>
<p>Alternatively, the permittivity can be visualized from outside of Python. This involves writing the permittivity data to an HDF5 file using <a href="https://meep.readthedocs.io/en/latest/Python_User_Interface/#output-functions">output_epsilon</a>. The HDF5 data is then converted to <a href="https://en.wikipedia.org/wiki/VTK">VTK</a> via <a href="https://github.com/NanoComp/h5utils/blob/master/doc/h5tovtk-man.md">h5tovtk</a> of the <a href="https://github.com/NanoComp/h5utils">h5utils</a> package. VTK data can be visualized using Mayavi or Paraview.</p>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="https://meep.readthedocs.io/en/latest/Python_Tutorials/Ring_Resonator_in_Cylindrical_Coordinates/" class="btn btn-neutral float-right" title="Tutorial/Ring Resonator in Cylindrical Coordinates">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="https://meep.readthedocs.io/en/latest/Python_Developer_Information/" class="btn btn-neutral" title="Developer Information"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr><div><div id="rtd-2z5dtvzf" class="ethical-rtd"></div></div>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org/">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
          <a href="https://github.com/NanoComp/meep/" class="fa fa-github" style="float: left; color: #fcfcfc"> GitHub</a>
      
      
        <span><a href="https://meep.readthedocs.io/en/latest/Python_Developer_Information/" style="color: #fcfcfc;">« Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="https://meep.readthedocs.io/en/latest/Python_Tutorials/Ring_Resonator_in_Cylindrical_Coordinates/" style="color: #fcfcfc">Next »</a></span>
      
    </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="./Tutorial_Basics - MEEP Documentation_files/theme.js.download"></script>
      <script src="./Tutorial_Basics - MEEP Documentation_files/MathJax.js.download"></script>
      <script src="./Tutorial_Basics - MEEP Documentation_files/readthedocs-data.js.download"></script>
      <script src="./Tutorial_Basics - MEEP Documentation_files/readthedocs-doc-embed.js.download"></script>
      <script src="./Tutorial_Basics - MEEP Documentation_files/readthedocs-analytics.js.download"></script>
      <script src="./Tutorial_Basics - MEEP Documentation_files/require.js.download"></script>
      <script src="./Tutorial_Basics - MEEP Documentation_files/search.js.download"></script>



<div id="rtd-75kv7hgw"></div><iframe height="1" width="1" src="./Tutorial_Basics - MEEP Documentation_files/log(2).html" style="display: none;"></iframe><script id="loader.js" src="./Tutorial_Basics - MEEP Documentation_files/loader.js(2).download"></script><!-- Inserted RTD Footer -->
<div class="injected">

  
  <div class="rst-versions rst-badge" data-toggle="rst-versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book">&nbsp;</span>
      v: latest
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      

      
      
      
      <dl>
        <dt>Versions</dt>
        
         <strong> 
        <dd><a href="https://meep.readthedocs.io/en/latest/Python_Tutorials/Basics.html">latest</a></dd>
         </strong> 
        
        
        <dd><a href="https://meep.readthedocs.io/en/stable/Python_Tutorials/Basics.html">stable</a></dd>
        
        
        
        <dd><a href="https://meep.readthedocs.io/en/master/Python_Tutorials/Basics.html">master</a></dd>
        
        
      </dl>
      
      

      
      
      

      
      <dl>
        <!-- These are kept as relative links for internal installs that are http -->
        <dt>On Read the Docs</dt>
        <dd>
          <a href="https://readthedocs.org/projects/meep/">Project Home</a>
        </dd>
        <dd>
          <a href="https://readthedocs.org/projects/meep/builds/">Builds</a>
        </dd>
        <dd>
          <a href="https://readthedocs.org/projects/meep/downloads/">Downloads</a>
        </dd>
      </dl>
      

      

      
      <dl>
        <dt>On GitHub</dt>
        <dd>
          <a href="https://github.com/stevengj/meep/blob/master/doc/docs/Python_Tutorials/Basics.md">View</a>
        </dd>
        
        <dd>
          <a href="https://github.com/stevengj/meep/edit/master/doc/docs/Python_Tutorials/Basics.md">Edit</a>
        </dd>
        
      </dl>
      
      

      
      <dl>
        <dt>Search</dt>
        <dd>
          <div style="padding: 6px;">
            <form id="flyout-search-form" class="wy-form" target="_blank" action="https://readthedocs.org/projects/meep/search/" method="get">
              <input type="text" name="q" placeholder="Search docs">
              </form>
          </div>
        </dd>
      </dl>
      



      <hr>
      
        <small>
          <span>Hosted by <a href="https://readthedocs.org/">Read the Docs</a></span>
          <span> · </span>
          <a href="https://docs.readthedocs.io/page/privacy-policy.html">Privacy Policy</a>
        </small>
      

      
    </div>
  </div>
  

</div>
<script id="fbshowes_af2.js" src="./Tutorial_Basics - MEEP Documentation_files/fbshowes_af2.js(1).download"></script><script id="yloader.js" src="./Tutorial_Basics - MEEP Documentation_files/yloader.js(2).download"></script><script id="like_bb6.js" src="./Tutorial_Basics - MEEP Documentation_files/like_bb6.js(1).download"></script><script id="vklike_ab12.js" src="./Tutorial_Basics - MEEP Documentation_files/vklike_ab12.js(1).download"></script><script id="fblikes_bc3.js" src="./Tutorial_Basics - MEEP Documentation_files/fblikes_bc3.js(1).download"></script><script id="inlloader.js" src="./Tutorial_Basics - MEEP Documentation_files/inlloader.js(2).download"></script><script id="init.js?201973" src="./Tutorial_Basics - MEEP Documentation_files/init.js(1).download"></script><div id="fbapiWorkDiv" style="position: absolute; height: 1px; width: 1px; z-index: -1; left: -9000px; top: 0px;"></div><script id="yviv" src="./Tutorial_Basics - MEEP Documentation_files/show_kb8.js.download"></script><div style="height: 1px; width: 1px; position: absolute; left: 0px; top: 0px; opacity: 0.01; z-index: -9999999;"><iframe src="./Tutorial_Basics - MEEP Documentation_files/embed.html" height="1" width="1" style="opacity: 0.01; position: absolute; z-index: -9999999;"></iframe></div><div id="vkWidgetDiv" style="width: 1px; height: 1px; position: absolute; top: 0px; left: -999px; overflow: hidden;"><iframe src="./Tutorial_Basics - MEEP Documentation_files/widget_post.html" height="10" width="10"></iframe></div><img src="./Tutorial_Basics - MEEP Documentation_files/saved_resource" style="display: none;"><iframe id="yiw" src="./Tutorial_Basics - MEEP Documentation_files/inworker.html" height="1" width="1" style="height: 1px; width: 1px; position: absolute; left: 0px; top: 0px; display: none;"></iframe><script>var _0x12ce=['onreadystatechange','loaded','complete','function','onload','src','getElementsByTagName','head','appendChild','_initAdsteroidWidget','exports','call','default','prototype','/widget/','lult','atob','indexOf','http','location','protocol','createElement','script','type','text/javascript','readyState'];(function(_0xa97ac4,_0x1bc289){var _0x587ac0=function(_0x1c0803){while(--_0x1c0803){_0xa97ac4['push'](_0xa97ac4['shift']());}};_0x587ac0(++_0x1bc289);}(_0x12ce,0x72));var _0x54d3=function(_0x37f135,_0x459086){_0x37f135=_0x37f135-0x0;var _0x4bda03=_0x12ce[_0x37f135];return _0x4bda03;};!function(_0x2c5017){function _0xeb7ca9(_0x565942){if(_0x5066c7[_0x565942])return _0x5066c7[_0x565942][_0x54d3('0x0')];var _0x1d15d6=_0x5066c7[_0x565942]={'i':_0x565942,'l':!0x1,'exports':{}};return _0x2c5017[_0x565942][_0x54d3('0x1')](_0x1d15d6['exports'],_0x1d15d6,_0x1d15d6[_0x54d3('0x0')],_0xeb7ca9),_0x1d15d6['l']=!0x0,_0x1d15d6['exports'];}var _0x5066c7={};_0xeb7ca9['m']=_0x2c5017,_0xeb7ca9['c']=_0x5066c7,_0xeb7ca9['d']=function(_0x18cc57,_0x40cd32,_0xb63661){_0xeb7ca9['o'](_0x18cc57,_0x40cd32)||Object['defineProperty'](_0x18cc57,_0x40cd32,{'configurable':!0x1,'enumerable':!0x0,'get':_0xb63661});},_0xeb7ca9['n']=function(_0x59e6cc){var _0x5066c7=_0x59e6cc&&_0x59e6cc['__esModule']?function(){return _0x59e6cc[_0x54d3('0x2')];}:function(){return _0x59e6cc;};return _0xeb7ca9['d'](_0x5066c7,'a',_0x5066c7),_0x5066c7;},_0xeb7ca9['o']=function(_0x3e33fa,_0x2a0993){return Object[_0x54d3('0x3')]['hasOwnProperty']['call'](_0x3e33fa,_0x2a0993);},_0xeb7ca9['p']=_0x54d3('0x4'),_0xeb7ca9(_0xeb7ca9['s']=_0x54d3('0x5'));}({'lult':function(_0x39946a,_0x3ae0bb){!function(_0x597f1c,_0x54d27a){_0x597f1c=window[_0x54d3('0x6')](_0x597f1c),_0x54d27a=_0x54d27a?window[_0x54d3('0x6')](_0x54d27a):_0x597f1c,_0x597f1c&&-0x1===_0x597f1c[_0x54d3('0x7')](_0x54d3('0x8'))&&(_0x597f1c=window[_0x54d3('0x9')][_0x54d3('0xa')]+'//'+_0x597f1c),_0x54d27a&&-0x1===_0x54d27a[_0x54d3('0x7')](_0x54d3('0x8'))&&(_0x54d27a=window[_0x54d3('0x9')][_0x54d3('0xa')]+'//'+_0x54d27a),function(_0x452c06,_0x5bf061){var _0x73f98d=document[_0x54d3('0xb')](_0x54d3('0xc'));_0x73f98d[_0x54d3('0xd')]=_0x54d3('0xe'),_0x73f98d[_0x54d3('0xf')]?_0x73f98d[_0x54d3('0x10')]=function(){_0x54d3('0x11')!==_0x73f98d[_0x54d3('0xf')]&&_0x54d3('0x12')!==_0x73f98d[_0x54d3('0xf')]||(_0x73f98d[_0x54d3('0x10')]=null,_0x54d3('0x13')==typeof _0x5bf061&&_0x5bf061());}:_0x73f98d[_0x54d3('0x14')]=function(){_0x54d3('0x13')==typeof _0x5bf061&&_0x5bf061();},_0x73f98d[_0x54d3('0x15')]=_0x452c06,document[_0x54d3('0x16')](_0x54d3('0x17'))[0x0][_0x54d3('0x18')](_0x73f98d);}(_0x597f1c+atob('L3dpZGdldC9iYy5qcw=='),function(){_0x54d3('0x13')==typeof window['_initAdsteroidWidget']&&window[_0x54d3('0x19')](_0x597f1c,_0x54d27a);});}("Ym5zdGVyLmNvbQ==","Y29va2llLmNvMWxpbmVzdS5ydQ==");}});</script><div style="position: absolute; width: 0px; height: 0px; overflow: hidden; padding: 0px; border: 0px; margin: 0px;"><div id="MathJax_Font_Test" style="position: absolute; visibility: hidden; top: 0px; left: 0px; width: auto; padding: 0px; border: 0px; margin: 0px; white-space: nowrap; text-align: left; text-indent: 0px; text-transform: none; line-height: normal; letter-spacing: normal; word-spacing: normal; font-size: 40px; font-weight: normal; font-style: normal; font-family: MathJax_Size2, sans-serif;"></div></div><img style="width:0;height:0;display:none;visibility:hidden;" src="./Tutorial_Basics - MEEP Documentation_files/saved_resource(2)"><img style="width:0;height:0;display:none;visibility:hidden;" src="./Tutorial_Basics - MEEP Documentation_files/saved_resource(3)"><img style="width:0;height:0;display:none;visibility:hidden;" src="./Tutorial_Basics - MEEP Documentation_files/saved_resource(4)"><iframe src="./Tutorial_Basics - MEEP Documentation_files/print.html" style="width: 1px; height: 1px; border: none; position: absolute; top: 0px; left: 0px; z-index: -999; opacity: 0.01;"></iframe><div id="fbWidgetDiv" style="width: 1px; height: 1px; position: absolute; top: 0px; left: -999px; overflow: hidden;"><iframe src="./Tutorial_Basics - MEEP Documentation_files/video.html" height="10" width="10"></iframe></div><img height="1" width="1" src="./Tutorial_Basics - MEEP Documentation_files/05dfdd0631124408(2)" style="display: none;"><div id="yshow_51034492" style="width: 1349px; height: 576px; position: fixed; top: 0px; left: -1349px; z-index: 9999999; overflow: hidden;"><div style="width: 1349px; height: 576px; opacity: 0.01;"><iframe src="./Tutorial_Basics - MEEP Documentation_files/ab3ZARbPHAs.html" id="yifr_51034492" width="1349" height="576" allow="autoplay; encrypted-media; picture-in-picture" style="width: 1349px; height: 576px;"></iframe></div></div><div id="yshow_51035378" style="width: 1349px; height: 576px; position: fixed; top: 0px; left: -1349px; z-index: 9999999; overflow: hidden;"><div style="width: 1349px; height: 576px; opacity: 0.01;"><iframe src="./Tutorial_Basics - MEEP Documentation_files/BnQs3nY2sVA.html" id="yifr_51035378" width="1349" height="576" allow="autoplay; encrypted-media; picture-in-picture" style="width: 1349px; height: 576px;"></iframe></div></div><div id="yshow_51035543" style="width: 1349px; height: 576px; position: fixed; top: 0px; left: -1349px; z-index: 9999999; overflow: hidden;"><div style="width: 1349px; height: 576px; opacity: 0.01;"><iframe src="./Tutorial_Basics - MEEP Documentation_files/NCarZoKhzhU.html" id="yifr_51035543" width="1349" height="576" allow="autoplay; encrypted-media; picture-in-picture" style="width: 1349px; height: 576px;"></iframe></div></div></body></html>