/* 
patches onchange events on hidden select and input elements used by PrimeFaces
make sure to use defer to load webcomponents-loader.js
or dispatch WebComponentsPrimefacesFix event on document
 */
(function () {
    // check only for primefaces characteristic hidden elements
    const selectors = '.ui-helper-hidden-accessible select, .ui-helper-hidden-accessible input';
    function restoreEvents() {
      // execute only if webcomponent polyfills has modified HTMLElement prototype
      if (!!document.createElement('a').__shady_children) {
        console.log('shadow dom poylfill detected, restoring onchange handlers');
        const selects = document.querySelectorAll(selectors);
        for (var i = 0; i < selects.length; i++) {
          const item = selects.item ? selects.item(i) : selects[i];
          if (item.id && !item.onchange && item.hasAttribute('onchange')) {
            item.onchange = new Function(item.getAttribute('onchange'));
          }
        }
      } else {
        // should see this in Chrome/FF
        console.log('no shadow dom polyfills detected');
      }
    }
    document.addEventListener('WebComponentsReady', restoreEvents);
    // can send an event if we need to run this again on some dynamic content
    document.addEventListener('WebComponentsPrimefacesFix', restoreEvents);
  })();